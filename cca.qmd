---
output: html_document
number-sections: false
bibliography: references.bib
---

# Analiza kanoniczna

Analiza kanoniczna (ang. *Canonical Correlation Analysis, CCA*) jest klasycznÄ…
technikÄ… statystycznÄ… sÅ‚uÅ¼Ä…cÄ… do badania zwiÄ…zkÃ³w pomiÄ™dzy dwoma zestawami
zmiennych wielowymiarowych. Jej podstawowym celem jest znalezienie takich
kombinacji liniowych zmiennych z obu zestawÃ³w, ktÃ³re maksymalizujÄ… wzajemnÄ…
korelacjÄ™ â€“ sÄ… to tzw. kanoniczne zmienne lub kanoniczne skÅ‚adniki. Technika ta
zostaÅ‚a wprowadzona przez Harolda Hotellinga w roku 1936, a wiÄ™c w okresie
intensywnego rozwoju metod statystycznych opartych na algebrze macierzy.

::: column-margin
![Harold Hotelling](images/hotelling.jpg)
:::

W tym samym czasie powstawaÅ‚y takÅ¼e inne fundamenty analizy wielowymiarowej,
takie jak analiza skÅ‚adowych gÅ‚Ã³wnych (PCA) czy dyskryminacja liniowa
(LDA)[^cca-1]. Analiza kanoniczna stanowi zatem jeden z filarÃ³w klasycznej
statystyki wielowymiarowej i do dziÅ› pozostaje istotnym narzÄ™dziem eksploracji
i modelowania zÅ‚oÅ¼onych zaleÅ¼noÅ›ci.

W odrÃ³Å¼nieniu od regresji wielorakiej, ktÃ³ra przewiduje zestaw zmiennych
zaleÅ¼nych na podstawie zestawu predyktorÃ³w, analiza kanoniczna traktuje obie
grupy zmiennych symetrycznie â€“ nie zakÅ‚ada istnienia wyraÅºnego kierunku
przyczynowego. Dlatego stosuje siÄ™ jÄ… w sytuacjach, gdy celem jest ogÃ³lna
analiza wspÃ³Å‚zaleÅ¼noÅ›ci pomiÄ™dzy dwoma zbiorami zmiennych, a nie przewidywanie
jednego zestawu na podstawie drugiego.

![PrzykÅ‚adowy model analizy kanonicznej](images/cca.png){width="500"}

Typowe zastosowania analizy kanonicznej obejmujÄ…:

-   Psychologia i nauki spoÅ‚eczne â€“ badanie relacji miÄ™dzy grupami testÃ³w
    poznawczych a zmiennymi demograficznymi.

    *PrzykÅ‚ad:* W badaniu dzieci w wieku szkolnym mierzy siÄ™ wyniki w testach:
    pamiÄ™ci, uwagi i szybkoÅ›ci przetwarzania informacji (zmienne poznawcze), a
    nastÄ™pnie porÃ³wnuje siÄ™ je z takimi cechami, jak wiek, poziom wyksztaÅ‚cenia
    rodzicÃ³w oraz status spoÅ‚eczno-ekonomiczny (zmienne demograficzne). Analiza
    kanoniczna pozwala oceniÄ‡, ktÃ³re kombinacje cech demograficznych sÄ…
    powiÄ…zane z ogÃ³lnym wzorcem zdolnoÅ›ci poznawczych.,

-   Biologia i medycyna â€“ analiza zaleÅ¼noÅ›ci pomiÄ™dzy pomiarami fizjologicznymi
    (np. poziomy hormonÃ³w) a cechami klinicznymi (np. objawy choroby).

    *PrzykÅ‚ad:* W grupie pacjentÃ³w z depresjÄ… mierzy siÄ™ poziomy kortyzolu,
    serotoniny i dopaminy (wskaÅºniki biologiczne), a takÅ¼e nasilenie objawÃ³w
    takich jak bezsennoÅ›Ä‡, brak apetytu, spadek energii czy anhedonia[^cca-2]
    (zmienne kliniczne). Analiza kanoniczna pomaga zidentyfikowaÄ‡ wspÃ³lnÄ…
    strukturÄ™ zmiennoÅ›ci â€“ np. czy okreÅ›lony wzorzec hormonalny odpowiada za
    okreÅ›lony profil objawÃ³w.

-   Ekonomia â€“ porÃ³wnywanie zestawÃ³w wskaÅºnikÃ³w ekonomicznych z rÃ³Å¼nych
    dziedzin (np. zmienne finansowe vs. konsumpcyjne).

    *PrzykÅ‚ad:* W badaniu krajÃ³w Unii Europejskiej zestawia siÄ™ wskaÅºniki
    makroekonomiczne, takie jak stopa inflacji, stopa bezrobocia i zadÅ‚uÅ¼enie
    publiczne (zmienne finansowe), z danymi dotyczÄ…cymi konsumpcji â€“ np.
    wydatki na kulturÄ™, transport i Å¼ywnoÅ›Ä‡ (zmienne konsumpcyjne). Analiza
    kanoniczna umoÅ¼liwia odkrycie wspÃ³lnych ukÅ‚adÃ³w zaleÅ¼noÅ›ci miÄ™dzy
    stabilnoÅ›ciÄ… finansowÄ… a wzorcami konsumpcji.

-   Lingwistyka korpusowa â€“ badania zbieÅ¼noÅ›ci struktur gramatycznych i
    semantycznych.

    *PrzykÅ‚ad:* W analizie duÅ¼ego korpusu tekstÃ³w (np. esejÃ³w studentÃ³w lub
    wypowiedzi politykÃ³w) zestawia siÄ™ cechy skÅ‚adniowe, takie jak dÅ‚ugoÅ›Ä‡
    zdaÅ„, liczba zdaÅ„ podrzÄ™dnie zÅ‚oÅ¼onych, liczba czasownikÃ³w (zmienne
    skÅ‚adniowe), z cechami semantycznymi takimi jak stopieÅ„ abstrakcyjnoÅ›ci
    uÅ¼ywanych rzeczownikÃ³w, nacechowanie emocjonalne sÅ‚ownictwa czy liczba
    metafor (zmienne semantyczne). CCA pozwala oceniÄ‡, czy bardziej zÅ‚oÅ¼ona
    skÅ‚adnia idzie w parze z wiÄ™kszÄ… abstrakcyjnoÅ›ciÄ… przekazu.

-   Genomika i bioinformatyka â€“ integracja danych z rÃ³Å¼nych platform
    pomiarowych (np. ekspresji genÃ³w i metylacji DNA[^cca-3]).

    *PrzykÅ‚ad:* Dla prÃ³bek guza nowotworowego analizuje siÄ™ jednoczeÅ›nie
    poziomy ekspresji genÃ³w (np. z RNA) i poziomy metylacji DNA (z
    mikromacierzy EPIC). CCA pozwala odnaleÅºÄ‡ kanoniczne kombinacje genÃ³w i
    regionÃ³w metylacyjnych, ktÃ³re sÄ… wspÃ³Å‚zmienne i mogÄ… byÄ‡ zwiÄ…zane z
    podtypem nowotworu lub odpowiedziÄ… na leczenie.

[^cca-1]: o ktÃ³rych juÅ¼ wkrÃ³tce

[^cca-2]: termin stosowany w psychologii i psychiatrii, ktÃ³ry oznacza utraconÄ…
    zdolnoÅ›Ä‡ do odczuwania przyjemnoÅ›ci z czynnoÅ›ci, ktÃ³re wczeÅ›niej byÅ‚y
    ÅºrÃ³dÅ‚em satysfakcji, radoÅ›ci lub zainteresowania

[^cca-3]: polega na chemicznym doÅ‚Ä…czaniu grupy metylowej (â€“CH~3~)

# Przypomnienie z algebry ğŸ˜‰

Na potrzeby definicji modeli kanonicznego potrzebne bÄ™dÄ… nam pewne twierdzenia
z zakresu algebry.

::: {#lem-1 .lem}
## NierÃ³wnoÅ›Ä‡ **Cauchy'egoâ€“Schwarza**[^cca-4]

Niech $a,b$ bÄ™dÄ… dwoma wektorami kolumnowymi o wymiarach $p\times 1$, wÃ³wczas

$$
(a^\top b)\leq (a^\top a)(b^\top b).
$$

PowyÅ¼sza nierÃ³wnoÅ›Ä‡ staje siÄ™ rÃ³wnoÅ›ciÄ… jeÅ›li $b=\lambda \cdot a$, dla pewnej
staÅ‚ej $\lambda$.
:::

::: {#lem-2 .lem}
## Twierdzenie o maksymalizacji formy kwadratowej[^cca-5]

Niech $\mathbf{B} \in \mathbb{R}^{p \times p}$ bÄ™dzie symetrycznÄ…, dodatnio
okreÅ›lonÄ… macierzÄ…, o uporzÄ…dkowanych malejÄ…co wartoÅ›ciach wÅ‚asnych
$\lambda_1 \geq \lambda_2 \geq \cdots \geq \lambda_p > 0$ oraz odpowiadajÄ…cych
im ortonormalnych wektorach wÅ‚asnych
$\boldsymbol{e}_1, \boldsymbol{e}_2, \ldots, \boldsymbol{e}_p$. WÃ³wczas:

1.  **Maksymalna wartoÅ›Ä‡ ilorazu Rayleigha** dla wszystkich niezerowych
    wektorÃ³w $\boldsymbol{x} \in \mathbb{R}^p$: $$
    \max_{\boldsymbol{x} \neq \boldsymbol{0}} \frac{\boldsymbol{x}^\top \mathbf{B} \boldsymbol{x}}{\boldsymbol{x}^\top \boldsymbol{x}} = \lambda_1,
    $$ i jest osiÄ…gana dla $\boldsymbol{x} = \boldsymbol{e}_1$, czyli wektora
    wÅ‚asnego odpowiadajÄ…cego najwiÄ™kszej wartoÅ›ci wÅ‚asnej.

2.  **Minimalna wartoÅ›Ä‡ ilorazu Rayleigha**:

$$
\min_{\boldsymbol{x} \neq \boldsymbol{0}} \frac{\boldsymbol{x}^\top \mathbf{B} \boldsymbol{x}}{\boldsymbol{x}^\top \boldsymbol{x}} = \lambda_p,
$$ i jest osiÄ…gana dla $\boldsymbol{x} = \boldsymbol{e}_p$, czyli wektora
wÅ‚asnego odpowiadajÄ…cego najmniejszej wartoÅ›ci wÅ‚asnej.

3.  **Ograniczona maksymalizacja w podprzestrzeni ortogonalnej do**
    $\boldsymbol{e}_1, \ldots, \boldsymbol{e}_k$:

JeÅ›li maksymalizacja jest prowadzona pod warunkiem ortogonalnoÅ›ci
$\boldsymbol{x} \perp \boldsymbol{e}_1, \ldots, \boldsymbol{e}_k$, wÃ³wczas: $$
\max_{\boldsymbol{x} \perp \boldsymbol{e}_1, \ldots, \boldsymbol{e}_k} \frac{\boldsymbol{x}^\top \mathbf{B} \boldsymbol{x}}{\boldsymbol{x}^\top \boldsymbol{x}} = \lambda_{k+1},
$$ i maksimum osiÄ…gane jest dla $\boldsymbol{x} = \boldsymbol{e}_{k+1}$.

Twierdzenie to formalizuje intuicjÄ™, Å¼e **wartoÅ›ci wÅ‚asne** macierzy
symetrycznej reprezentujÄ… **ekstremalne wartoÅ›ci formy kwadratowej** w
kierunkach okreÅ›lonych przez wektory wÅ‚asne.
:::

Oto **matematyczna definicja modelu CCA** oraz **dowÃ³d istnienia rozwiÄ…zania**,
sformuÅ‚owana Å›ciÅ›le w duchu Twojego tekstu:

[^cca-4]: znanej rÃ³wnieÅ¼ jako Cauchyâ€™egoâ€“Buniakowskiegoâ€“Schwarzaâ€“BienaymÃ©

[^cca-5]: znane rÃ³wnieÅ¼ jako lemat Rayleigha-Ritza

# Definicja modelu

Niech $$
\begin{pmatrix}
X\\
Y
\end{pmatrix}
\sim
\mathcal{N}_{p+q}\left(
\begin{pmatrix}
\mu \\
\nu
\end{pmatrix},
\begin{pmatrix}
\Sigma_{XX} & \Sigma_{XY}\\
\Sigma_{YX} & \Sigma_{YY}
\end{pmatrix}
\right)
$$ {#eq-normal}

gdzie:

-   $X \in \mathbb{R}^{q}$ i $Y \in \mathbb{R}^{p}$,
-   $\Sigma_{XX}$ i $\Sigma_{YY}$ to macierze kowariancji odpowiednio
    $q \times q$ i $p \times p$,
-   $\Sigma_{XY}=\Sigma_{YX}^\top$ to macierz kowariancji miÄ™dzy $X$ i $Y$.

Szukamy wektorÃ³w $a \in \mathbb{R}^q$, $b \in \mathbb{R}^p$, ktÃ³re
**maksymalizujÄ… korelacjÄ™** pomiÄ™dzy kombinacjami liniowymi $$
U=a^\top X, \quad V=b^\top Y,
$$ czyli $$
\rho(a,b)=\frac{a^\top \Sigma_{XY}b}{\sqrt{a^\top \Sigma_{XX}a},\sqrt{b^\top \Sigma_{YY}b}}.
$$

Pierwsza para kanoniczna $(a_1,b_1)$ to para rozwiÄ…zujÄ…ca ten problem
maksymalizacji. Kolejne pary $(a_k,b_k)$ definiuje siÄ™ analogicznie, przy
dodatkowych warunkach ortogonalnoÅ›ci wzglÄ™dem wczeÅ›niejszych par.

# DowÃ³d istnienia rozwiÄ…zania

## SformuÅ‚owanie problemu wÅ‚asnego

PrzeksztaÅ‚Ä‡my zmienne $$
c=\Sigma_{XX}^{1/2}a,\quad d=\Sigma_{YY}^{1/2}b.
$$

WÃ³wczas $$
\rho(a,b)=\frac{c^\top\Sigma_{XX}^{-1/2}\Sigma_{XY}\Sigma_{YY}^{-1/2}d}{\sqrt{c^\top c}\sqrt{d^\top d}}.
$$

Z lematu Cauchyâ€™egoâ€“Buniakowskiegoâ€“Schwarza mamy $$
\left|c^\top \mathbf{M} d\right| \le
\bigl(c^\top \mathbf{M}\mathbf{M}^\top c\bigr)^{1/2}\bigl(d^\top d\bigr)^{1/2},
\quad \text{gdzie }\mathbf{M}=\Sigma_{XX}^{-1/2}\Sigma_{XY}\Sigma_{YY}^{-1/2}.
$$ {#eq-cbs}

Zatem $$
\rho(a,b)^2 \le
\frac{c^\top\mathbf{M}\mathbf{M}^\top c}{c^\top c}.
$$

PoniewaÅ¼
$\mathbf{M}\mathbf{M}^\top=\Sigma_{XX}^{-1/2}\Sigma_{XY}\Sigma_{YY}^{-1}\Sigma_{YX}\Sigma_{XX}^{-1/2}$
jest macierzÄ… symetrycznÄ… dodatnio okreÅ›lonÄ…, z lematu Rayleighaâ€“Ritza
otrzymujemy $$
\max_{c\neq 0}\frac{c^\top\mathbf{M}\mathbf{M}^\top c}{c^\top c}=\lambda_1,
$$ gdzie $\lambda_1$ to najwiÄ™ksza wartoÅ›Ä‡ wÅ‚asna tej macierzy, osiÄ…gana dla
$c=e_1$ â€“ jej wektora wÅ‚asnego.

JeÅ›li $$
d \propto \Sigma_{YY}^{-1/2}\Sigma_{YX}\Sigma_{XX}^{-1/2}e_1
$$ to @eq-cbs staje siÄ™ rÃ³wnoÅ›ciÄ….

WracajÄ…c do oryginalnych wspÃ³Å‚czynnikÃ³w $$
a_1=\Sigma_{XX}^{-1/2}e_1,\quad
b_1\propto \Sigma_{YY}^{-1/2}\Sigma_{YX}\Sigma_{XX}^{-1/2}e_1.
$$

Pierwsza korelacja kanoniczna wynosi wÃ³wczas $$
\rho_1=\sqrt{\lambda_1}.
$$

Analogicznie dla kolejnych par, przy zaÅ‚oÅ¼eniu $c\perp e_1,\dots,e_{k-1}$, mamy
$$
\rho_k=\sqrt{\lambda_k},
$$ gdzie $\lambda_k$ to kolejne wartoÅ›ci wÅ‚asne macierzy
$\Sigma_{XX}^{-1/2}\Sigma_{XY}\Sigma_{YY}^{-1}\Sigma_{YX}\Sigma_{XX}^{-1/2}$, a
odpowiadajÄ…ce im wektory wÅ‚asne $e_k$ definiujÄ… kolejne wektory kanoniczne $$
U_k=e_k^\top\Sigma_{XX}^{-1/2}X,\quad
V_k=f_k^\top\Sigma_{YY}^{-1/2}Y,\quad
f_k\propto \Sigma_{YY}^{-1/2}\Sigma_{YX}\Sigma_{XX}^{-1/2}e_k.
$$

## WÅ‚asnoÅ›ci rozwiÄ…zaÅ„

Dla kaÅ¼dej pary $(U_k,V_k)$ zachodzi $$
\mathrm{Var}(U_k)=\mathrm{Var}(V_k)=1,\quad
\mathrm{Cov}(U_k,U_l)=\mathrm{Cov}(V_k,V_l)=\mathrm{Cov}(U_k,V_l)=0\quad (k\neq l).
$$

::: callout-note
### DowÃ³d powyÅ¼szych rÃ³wnoÅ›ci

Dla danej pary wektorÃ³w kanonicznych mamy

$$
U_k = a_k^\top X = e_k^\top \Sigma_{XX}^{-1/2} X,
    \qquad
    V_k = b_k^\top Y = f_k^\top \Sigma_{YY}^{-1/2} Y,
$$ gdzie:

-   $e_k$ jest ortonormalnym[^cca-6] wektorem wÅ‚asnym macierzy
    $\Sigma_{XX}^{-1/2} \Sigma_{XY} \Sigma_{YY}^{-1} \Sigma_{YX} \Sigma_{XX}^{-1/2}$
-   $f_k \propto \Sigma_{YY}^{-1/2} \Sigma_{YX} \Sigma_{XX}^{-1/2} e_k$,
-   $\rho_k = \sqrt{\lambda_k}$, gdzie $\lambda_k$ to odpowiadajÄ…ca wartoÅ›Ä‡
    wÅ‚asna.

Macierze $\Sigma_{XX}$, $\Sigma_{YY}$ sÄ… dodatnio okreÅ›lone, wiÄ™c moÅ¼na
wprowadziÄ‡ transformacje $$
\tilde{X} = \Sigma_{XX}^{-1/2}X, \quad \tilde{Y} = \Sigma_{YY}^{-1/2}Y.
$$ Zatem $$
U_k = e_k^\top \tilde{X},\quad V_k = f_k^\top \tilde{Y}.
$$

Najpierw udowodnimy, Å¼e
$\operatorname{Var}(U_k) = \operatorname{Var}(V_k) = 1$.

Zmienna $U_k = e_k^\top \tilde{X}$, wiÄ™c $$
\operatorname{Var}(U_k) = \operatorname{Var}(e_k^\top \tilde{X}) = e_k^\top \operatorname{Var}(\tilde{X}) e_k.
$$ ZauwaÅ¼my, Å¼e $$
\operatorname{Var}(\tilde{X}) = \Sigma_{XX}^{-1/2} \Sigma_{XX} \Sigma_{XX}^{-1/2} = I,
$$ wiÄ™c $$
\operatorname{Var}(U_k) = e_k^\top I e_k = e_k^\top e_k = 1.
$$ Analogicznie $$
\operatorname{Var}(V_k) = f_k^\top \operatorname{Var}(\tilde{Y}) f_k = f_k^\top f_k = 1,
$$ poniewaÅ¼ $\tilde{Y}$ ma jednostkowÄ… macierz kowariancji, a $f_k$ sÄ…
znormalizowane.

Teraz dowiedziemy, Å¼e $\operatorname{Cov}(U_k, U_l) = 0$ dla $k \neq l$

$$
\operatorname{Cov}(U_k, U_l) = \operatorname{Cov}(e_k^\top \tilde{X}, e_l^\top \tilde{X}) = e_k^\top \operatorname{Var}(\tilde{X}) e_l = e_k^\top e_l.
$$ PoniewaÅ¼ $e_k$, $e_l$ sÄ… ortonormalnymi wektorami wÅ‚asnymi symetrycznej
macierzy, to $$
e_k^\top e_l = 0 \quad \text{dla } k \neq l.
$$ Zatem $$
\operatorname{Cov}(U_k, U_l) = 0.
$$ Podobnie $$
\operatorname{Cov}(V_k, V_l) = f_k^\top f_l = 0 \quad \text{dla } k \neq l.
$$

Na koniec dowiedÅºmy, Å¼e $\operatorname{Cov}(U_k, V_l) = 0$ dla $k \neq l$ $$
\operatorname{Cov}(U_k, V_l) = \operatorname{Cov}(e_k^\top \tilde{X}, f_l^\top \tilde{Y}) = e_k^\top \operatorname{Cov}(\tilde{X}, \tilde{Y}) f_l.
$$ Z definicji $$
\operatorname{Cov}(\tilde{X}, \tilde{Y}) = \Sigma_{XX}^{-1/2} \Sigma_{XY} \Sigma_{YY}^{-1/2} =: M.
$$ Zatem $$
\operatorname{Cov}(U_k, V_l) = e_k^\top M f_l.
$$ Z poprzednich wyprowadzeÅ„ $$
f_l \propto M^\top e_l.
$$ Zatem $$
\operatorname{Cov}(U_k, V_l) \propto e_k^\top M M^\top e_l.
$$ Ale macierz $MM^\top$ jest symetryczna, a $e_k$ sÄ… jej ortonormalnymi
wektorami wÅ‚asnymi, wiÄ™c $$
e_k^\top MM^\top e_l = 0 \quad \text{dla } k \neq l.
$$ Zatem $$
\operatorname{Cov}(U_k, V_l) = 0.
$$
:::

Ponadto korelacje kanoniczne sÄ… niezmiennicze wzglÄ™dem odwracalnych
przeksztaÅ‚ceÅ„ liniowych $X$ i $Y$: $$
X^*=\mathcal{U}^TX+u,\quad Y^*=\mathcal{V}^TY+v \implies
\rho_i(X^*,Y^*)=\rho_i(X,Y).
$$

[^cca-6]: ortonormalnoÅ›Ä‡ wynika z niezmienniczoÅ›ci korelacji wzglÄ™dem dÅ‚ugoÅ›ci
    wektorÃ³w

# Testowanie liczby istotnych korelacji kanonicznych

W kontekÅ›cie analizy kanonicznej (CCA), istotnym zagadnieniem jest testowanie
liczby istotnych korelacji kanonicznych. Celem jest ustalenie, ile par
zmiennych kanonicznych (kombinacji liniowych zmiennych z dwÃ³ch zbiorÃ³w $X$ i
$Y$) jest statystycznie istotnie skorelowanych. W tym celu stosuje siÄ™ testy
statystyczne, ktÃ³re pozwalajÄ… odrzuciÄ‡ hipotezÄ™ zerowÄ… o braku skorelowania
miÄ™dzy zbiorami zmiennych.

## Hipoteza zerowa i alternatywna

Dla zbiorÃ³w zmiennych $X \in \mathbb{R}^p$, $Y \in \mathbb{R}^q$, testujemy

-   $H_0: \rho_1 = \rho_2 = \cdots = \rho_s = 0$ â€“ brak istotnych korelacji
    kanonicznych (pierwiastkÃ³w),
-   $H_1$: istnieje co najmniej jedna istotna korelacja kanoniczna, tj.
    $\exists i \leq s \ \text{takie, Å¼e } \rho_i \ne 0$.

gdzie $s = \min(p, q)$, a $\rho_i$ to $i$-ta korelacja kanoniczna.

## Statystyka testowa â€“ test Wilka

W celu przetestowania tej hipotezy, wykorzystuje siÄ™ statystykÄ™ Wilka, ktÃ³ra
bazuje na iloczynie skÅ‚adnikÃ³w postaci ($1 - \lambda_i$), gdzie $\lambda_i$ to
wartoÅ›ci wÅ‚asne odpowiadajÄ…ce kwadratom korelacji kanonicznych $$
\lambda_i = \rho_i^2.
$$ Statystyka Wilkas jest zdefiniowana jako $$
\Lambda = \prod_{i=1}^s (1 - \lambda_i).
$$

Interpretacja - im mniejsze wartoÅ›ci $\Lambda$, tym wiÄ™ksza zaleÅ¼noÅ›Ä‡ miÄ™dzy
zbiorami $X$ i $Y$. DuÅ¼e wartoÅ›ci $\lambda_i$ (czyli silne korelacje
kanoniczne) powodujÄ…, Å¼e $\Lambda$ dÄ…Å¼y do zera.

W praktyce, dla prÃ³by $n$-elementowej, stosujemy wersjÄ™ testu bazujÄ…cÄ… na
macierzach kowariancji estymowanych z prÃ³by $S_{XX}, S_{XY}, S_{YX}, S_{YY})$ â€“
odpowiedniki $\Sigma_{XX}, \Sigma_{XY}, \Sigma_{YX}, \Sigma_{YY}$.

WÃ³wczas $$
T^2/n = \left|I - S_{YY}^{-1} S_{YX} S_{XX}^{-1} S_{XY} \right| = \prod_{i=1}^s (1 - \hat{\lambda}_i),
$$ gdzie $\hat{\lambda}_i$ to *prÃ³bkowe wartoÅ›ci wÅ‚asne* (szacunki
$\lambda_i$).

## RozkÅ‚ad asymptotyczny i transformacja do rozkÅ‚adu $\chi^2$

Wielu autorÃ³w (np. @marriott1986) sugeruje przeksztaÅ‚cenie statystyki Wilksa do
postaci asymptotycznie zgodnej z rozkÅ‚adem $\chi^2$, np. za pomocÄ…
transformacji

$$
-\left(n - \frac{1}{2}(p + q + 1) \right) \cdot \ln(\Lambda) \sim \chi^2_{pq}.
$$

## Procedura testowania

1.  Oszacuj wszystkie korelacje kanoniczne
    $\hat{\rho}_1, \ldots, \hat{\rho}_p$.
2.  Od $k = 0$ do $p-1$ oblicz
    $\Lambda_k = \prod_{i=k+1}^{p}(1 - \hat{\rho}_i^2)$.
3.  Oblicz transformacjÄ™
    $\chi^2_k=-\left(n - \frac{1}{2}(p + q + 1) \right) \cdot \ln(\Lambda_k)$
4.  PorÃ³wnaj z odpowiednim kwantylem rozkÅ‚adu $\chi^2$ z $(q - k)(r - k)$
    stopniami swobody.
5.  JeÅ›li wartoÅ›Ä‡ statystyki przekracza ten kwantyl ($p<\alpha$), odrzuÄ‡
    $H_0^{(k)}$ i przejdÅº do $k+1$. JeÅ›li nie, zatrzymaj siÄ™ â€“ kolejne
    korelacje uznajemy za nieistotne.

Ocena dopasowania modelu w analizie kanonicznej (CCA â€“ *Canonical Correlation
Analysis*) obejmuje kilka istotnych wskaÅºnikÃ³w diagnostycznych, ktÃ³re pozwalajÄ…
zrozumieÄ‡ siÅ‚Ä™ i strukturÄ™ relacji miÄ™dzy dwoma zbiorami zmiennych. PoniÅ¼ej
omÃ³wione zostaÅ‚y trzy kluczowe miary: Å‚adunki czynnikowe, wariancja wyjaÅ›niona
oraz redundancja.

# Ocena dopasowania modelu

## Åadunki czynnikowe (ang. *canonical loadings*)

-   **Definicja** - korelacje pomiÄ™dzy zmiennymi kanonicznymi (czyli
    kombinacjami liniowymi wektorÃ³w $a_k'X$ i $b_k'Y$) a oryginalnymi zmiennymi
    ze zbiorÃ³w $X$ i $Y$.
-   **Interpretacja**:
    -   PokazujÄ…, ktÃ³re konkretne zmienne pierwotne w najwiÄ™kszym stopniu
        â€Å‚adujÄ… siÄ™â€ (czyli kontrybuujÄ…) na danÄ… zmiennÄ… kanonicznÄ….
    -   Wysoka wartoÅ›Ä‡ (np. \> 0.7) wskazuje na silnÄ… zaleÅ¼noÅ›Ä‡ miÄ™dzy zmiennÄ…
        oryginalnÄ… a danÄ… zmiennÄ… kanonicznÄ….
    -   Znaki dodatnie/ujemne pozwalajÄ… wnioskowaÄ‡ o kierunku zwiÄ…zku.
-   **WzÃ³r**:
    -   Dla zbioru $X$: $$
        \text{loadings}_X = \mathrm{Corr}(X, U_k) = \Sigma_{XX} a_k
        $$
    -   Dla zbioru $Y$: $$
        \text{loadings}_Y = \mathrm{Corr}(Y, V_k) = \Sigma_{YY} b_k
        $$

## Wariancja wyjaÅ›niona (ang. *variance explained*)

-   **Definicja** - Å›rednia kwadratÃ³w Å‚adunkÃ³w czynnikowych dla kaÅ¼dej zmiennej
    kanonicznej i kaÅ¼dego zbioru danych.
-   **Interpretacja**:
    -   Informuje, jakÄ… czÄ™Å›Ä‡ wariancji oryginalnych zmiennych w danym zbiorze
        ($X$ lub $Y$) wyjaÅ›nia dana zmienna kanoniczna.
    -   MoÅ¼na traktowaÄ‡ ten wskaÅºnik jako odpowiednik wspÃ³Å‚czynnika
        determinacji $R^2$ dla pojedynczej zmiennej kanonicznej.
    -   Wysoka wartoÅ›Ä‡ oznacza, Å¼e dana zmienna kanoniczna dobrze reprezentuje
        zbiÃ³r, z ktÃ³rego zostaÅ‚a utworzona.
-   **WzÃ³r**: $$
    \text{Explained variance} = \frac{1}{p} \sum_{j=1}^{p} \mathrm{Corr}^2(X_j, U_k)
    $$ gdzie $p$ to liczba zmiennych w zbiorze $X$, a $U_k$ to $k$-ta zmienna
    kanoniczna.

## Redundancja (ang. *redundancy index*)

-   **Definicja** - iloczyn kwadratu korelacji kanonicznej $\rho_k^2$ oraz
    wariancji wyjaÅ›nionej przez danÄ… zmiennÄ… kanonicznÄ… we wÅ‚asnym zbiorze.
-   **Interpretacja**:
    -   Informuje, jaka czÄ™Å›Ä‡ przeciÄ™tnej wariancji jednej grupy zmiennych jest
        wyjaÅ›niana przez zmiennÄ… kanonicznÄ… utworzonÄ… na podstawie drugiego
        zbioru.
    -   Miara ta pokazuje, czy dany zbiÃ³r zmiennych wnosi unikalnÄ… informacjÄ™ o
        drugim zbiorze.
    -   Wysoka redundancja oznacza, Å¼e istnieje istotny zwiÄ…zek miÄ™dzy
        strukturami dwÃ³ch zbiorÃ³w zmiennych.
-   **WzÃ³r**: $$
    \text{Redundancy}_X = \rho_k^2 \cdot \left( \frac{1}{p} \sum_{j=1}^{p} \mathrm{Corr}^2(X_j, U_k) \right)
    $$ Analogicznie definiujemy redundancjÄ™ wzglÄ™dem $Y$.

| Miara | Co opisuje | Interpretacja praktyczna |
|--------------------|--------------------------------|---------------------------|
| Åadunki czynnikowe | SiÅ‚Ä™ powiÄ…zania zmiennej oryginalnej z kanonicznÄ… | Wysoka wartoÅ›Ä‡ â‡’ silna reprezentacja zmiennej |
| Wariancja wyjaÅ›niona | Åšrednia siÅ‚a reprezentacji zbioru przez zm. kanonicznÄ… | Miara dopasowania struktury do zbioru |
| Redundancja | IloÅ›Ä‡ informacji o jednym zbiorze zawarta w drugim | Miara istotnoÅ›ci relacji miÄ™dzy zbiorami |

# ZaÅ‚oÅ¼enia stosowalnoÅ›ci analizy kanonicznej

## NormalnoÅ›Ä‡ wielowymiarowa

ZakÅ‚ada siÄ™, Å¼e obydwa zbiory zmiennych losowych â€“ $X$ i $Y$ â€“ sÄ… wspÃ³lnie
rozkÅ‚adem normalnym wielowymiarowym jak podano w @eq-normal. NormalnoÅ›Ä‡
umoÅ¼liwia stosowanie testÃ³w statystycznych (np. testu Wilksa) do oceny liczby
istotnych korelacji kanonicznych.

## Brak wartoÅ›ci odstajÄ…cych (outliers)

ZarÃ³wno obserwacje odstajÄ…ce jednowymiarowe, jak i wielowymiarowe mogÄ… istotnie
zaburzaÄ‡ wynik analizy kanonicznej. OdstajÄ…ce wartoÅ›ci mogÄ… wpÅ‚ywaÄ‡ na macierze
kowariancji, zmieniajÄ…c kierunki i siÅ‚y relacji miÄ™dzy zbiorami zmiennych.

## WystarczajÄ…ca liczba obserwacji

Liczba obserwacji powinna znaczÄ…co przekraczaÄ‡ liczbÄ™ zmiennych w kaÅ¼dym
zbiorze. Liczba obserwacji $n$ w kaÅ¼dej grupie powinna byÄ‡ wiÄ™ksza niÅ¼ suma
liczby zmiennych w $X$ i $Y$ $$
n > p + q
$$ Zapewnia odwracalnoÅ›Ä‡ macierzy kowariancji oraz stabilnoÅ›Ä‡ estymatorÃ³w.

## LiniowoÅ›Ä‡ zaleÅ¼noÅ›ci

ZakÅ‚ada siÄ™, Å¼e zwiÄ…zki miÄ™dzy wszystkimi parami zmiennych sÄ… liniowe. PoniewaÅ¼
CCA opiera siÄ™ na maksymalizacji liniowych kombinacji, nieliniowe zaleÅ¼noÅ›ci
mogÄ… pozostaÄ‡ niewykryte.

## Brak nadmiernej wspÃ³Å‚liniowoÅ›ci (multikolinearnoÅ›ci)

Zmienne wewnÄ…trz kaÅ¼dego zbioru (w $X$ lub w $Y$) nie powinny byÄ‡ nadmiernie
skorelowane. Wysoka wspÃ³Å‚liniowoÅ›Ä‡ moÅ¼e prowadziÄ‡ do niestabilnych i trudnych
do interpretacji wektorÃ³w kanonicznych.

## NiezaleÅ¼noÅ›Ä‡ obserwacji

KaÅ¼da obserwacja powinna pochodziÄ‡ od innej jednostki (brak powtÃ³rzeÅ„
pomiarÃ³w). NiezaleÅ¼noÅ›Ä‡ warunkuje poprawnoÅ›Ä‡ estymatorÃ³w kowariancji.

# Implementacje CCA w R

Istnieje wiele bibliotek w jÄ™zyku R umoÅ¼liwiajÄ…cych wykonanie analizy
kanonicznej. WÅ›rÃ³d najbardziej znanych sÄ…: `CCA::cc()`, `stats::cancor()`),
`yacca::cca()` oraz w wersji regularyzowanej `mixOmics::rcc()`.

::: exm-1
Oszacujemy zwiÄ…zek miÄ™dzy dwoma zestawami zmiennych w zbiorze `mtcars` przy
uÅ¼yciu funkcji `cca()` z pakietu `yacca`.

ZbiÃ³r `X` â€“ zmienne zwiÄ…zane z konstrukcjÄ… silnika i ukÅ‚adem napÄ™dowym:

-   `cyl` â€“ liczba cylindrÃ³w,
-   `disp` â€“ pojemnoÅ›Ä‡ skokowa silnika,
-   `hp` â€“ moc silnika,
-   `drat` â€“ przeÅ‚oÅ¼enie tylnego mostu,
-   `vs` â€“ ukÅ‚ad cylindrÃ³w.

ZbiÃ³r `Y` â€“ zmienne zwiÄ…zane z osiÄ…gami i eksploatacjÄ…:

-   `mpg` â€“ zuÅ¼ycie paliwa,
-   `qsec` â€“ czas przyspieszenia na odcinku 1/4 mili,
-   `wt` â€“ masa pojazdu,
-   `gear` â€“ liczba biegÃ³w,
-   `am` â€“ typ skrzyni biegÃ³w (0 = automatyczna, 1 = manualna).

```{r}
library(yacca)

X <- mtcars[, c("cyl", "disp", "hp", "drat", "vs")]
Y <- mtcars[, c("mpg", "qsec", "wt", "gear", "am")]

model <- cca(X, Y, xcenter = T, ycenter = T, xscale = T, yscale = T)
summary(model)
```

Teraz przeanalizujemy wyniki modelu. Zaczniemy od korelacji kanonicznych, ktÃ³re
moÅ¼na wywoÅ‚aÄ‡ za pomocÄ… `model$corr`.

Wyniki analizy kanonicznej wskazujÄ…, Å¼e pierwsza zmienna kanoniczna (`CV 1`)
charakteryzuje siÄ™ bardzo wysokÄ… korelacjÄ… kanonicznÄ…, rÃ³wnÄ… 0.967. Oznacza to,
Å¼e istnieje silny zwiÄ…zek liniowy pomiÄ™dzy odpowiednimi kombinacjami liniowymi
zmiennych ze zbiorÃ³w $X$ i $Y$. Dodatkowo, wartoÅ›Ä‡ wspÃ³lnej wariancji dla tej
zmiennej wynosi 93.4%, co oznacza, Å¼e ta pierwsza para zmiennych kanonicznych
wyjaÅ›nia znacznÄ… czÄ™Å›Ä‡ wspÃ³Å‚zaleÅ¼noÅ›ci miÄ™dzy oboma zestawami zmiennych. Druga
zmienna kanoniczna (`CV 2`) rÃ³wnieÅ¼ wykazuje silnÄ… korelacjÄ™, rÃ³wnÄ… 0.853, co
sugeruje istnienie kolejnego istotnego zwiÄ…zku miÄ™dzy pozostaÅ‚ymi informacjami
zawartymi w zbiorach $X$ i $Y$. WspÃ³lna wariancja dla tej pary wynosi 72.7%, co
wciÄ…Å¼ stanowi wysoki poziom wyjaÅ›nienia wspÃ³Å‚zmiennoÅ›ci.

Kolejne zmienne kanoniczne (`CV 3, CV 4, CV 5`) wykazujÄ… juÅ¼ znacznie sÅ‚absze
korelacje kanoniczne â€“ odpowiednio 0.495, 0.388 i 0.115. Oznacza to, Å¼e siÅ‚a
zaleÅ¼noÅ›ci miÄ™dzy dalszymi kombinacjami liniowymi zmiennych $X$ i $Y$ jest
wyraÅºnie mniejsza. Co wiÄ™cej, wspÃ³lna wariancja spada (`model$corrsq`) dla tych
par odpowiednio do 24.5%, 15.1% i jedynie 1.3%. Te wartoÅ›ci sugerujÄ…, Å¼e
trzecia i kolejne zmienne kanoniczne mogÄ… mieÄ‡ ograniczonÄ… wartoÅ›Ä‡
interpretacyjnÄ… i potencjalnie moÅ¼na je pominÄ…Ä‡ w interpretacji, szczegÃ³lnie
jeÅ›li wyniki testÃ³w istotnoÅ›ci (np. test Bartletta) nie potwierdzajÄ… ich
znaczenia.

Wyniki testu chi-kwadrat Bartletta pozwalajÄ… oceniÄ‡, ktÃ³re pary zmiennych
kanonicznych sÄ… statystycznie istotne, tzn. ktÃ³re z nich wyjaÅ›niajÄ… istotnÄ…
czÄ™Å›Ä‡ wspÃ³Å‚zmiennoÅ›ci miÄ™dzy dwoma zbiorami zmiennych.

-   Pierwsza kanoniczna korelacja (`CV 1`) jest wysoce istotna statystycznie,
    co potwierdza bardzo niski poziom istotnoÅ›ci $p < 2.3 \times 10^{-13}$. To
    oznacza, Å¼e pierwsza para zmiennych kanonicznych wyjaÅ›nia istotnÄ… czÄ™Å›Ä‡
    zaleÅ¼noÅ›ci pomiÄ™dzy zbiorami $X$ i $Y$.
-   Druga kanoniczna korelacja (`CV 2`) rÃ³wnieÅ¼ jest istotna, choÄ‡ nie tak
    silnie jak pierwsza. WartoÅ›Ä‡ statystyki wynosi 44.81 przy 16 stopniach
    swobody, a poziom istotnoÅ›ci to okoÅ‚o $p = 0.00015$, co takÅ¼e pozwala na
    odrzucenie hipotezy zerowej o braku korelacji na tym poziomie.
-   Trzecia (`CV 3`), czwarta (`CV 4`) i piÄ…ta (`CV 5`) korelacje kanoniczne
    nie sÄ… istotne statystycznie. Ich wartoÅ›ci $p$-value przekraczajÄ…
    standardowe poziomy istotnoÅ›ci (0.05), co oznacza brak wystarczajÄ…cych
    dowodÃ³w na to, Å¼e odpowiadajÄ…ce im kombinacje zmiennych $X$ i $Y$ sÄ…
    skorelowane w populacji.

Na podstawie testu Bartletta moÅ¼na stwierdziÄ‡, Å¼e tylko pierwsze dwie
kanoniczne pary zmiennych $(U_1, V_1)$ i $(U_2, V_2)$ sÄ… istotne statystycznie.
Kolejne pary nie wnoszÄ… istotnej informacji o zaleÅ¼noÅ›ci miÄ™dzy zbiorami
zmiennych i moÅ¼na je pominÄ…Ä‡ w interpretacji oraz dalszej analizie. Taki
wniosek jest zgodny z wczeÅ›niejszÄ… ocenÄ… siÅ‚y korelacji kanonicznych oraz
wspÃ³lnej wariancji.

Interpretacja wag kanonicznych (*canonical variate coefficients* -
`model$xcoef` i `model$ycoef`) oraz Å‚adunkÃ³w strukturalnych (*structural
correlations*, inaczej *loadings* - `model$xstructcorr` i `model$ystructcorr`)
pozwala na peÅ‚ne zrozumienie, ktÃ³re zmienne pierwotne majÄ… najwiÄ™kszy wpÅ‚yw na
poszczegÃ³lne zmienne kanoniczne oraz jak mocno sÄ… z nimi skorelowane. W
interpretacji naleÅ¼y analizowaÄ‡ oba zestawy danych rÃ³wnoczeÅ›nie â€“ zarÃ³wno dla
zmiennych $X$, jak i $Y$.

`CV 1`

-   Dla zmiennych $X$, najwiÄ™kszy wpÅ‚yw majÄ…: `disp` (â€“0.44), `cyl` (â€“0.35),
    `hp` (â€“0.10) â€“ czyli im wiÄ™ksza pojemnoÅ›Ä‡ i liczba cylindrÃ³w, tym niÅ¼sza
    wartoÅ›Ä‡ zmiennej kanonicznej $U_1$.
-   Dla zmiennych $Y$, najistotniejsze sÄ…: `wt` (â€“0.56), `qsec` (0.56), `gear`
    (0.20) â€“ wskazuje to, Å¼e $V_1$ roÅ›nie wraz z `qsec` i `gear`, a maleje przy
    wzroÅ›cie `wt`.

JednoczeÅ›nie Å‚adunki strukturalne pokazujÄ…, jak silnie poszczegÃ³lne zmienne
oryginalne sÄ… skorelowane z danÄ… zmiennÄ… kanonicznÄ…:

-   Dla $X$: `cyl` (â€“0.98), `disp` (â€“0.97), `hp` (â€“0.86), `vs` (0.83) â€“ bardzo
    silne powiÄ…zania ze zmiennymi opisujÄ…cymi silnik.
-   Dla $Y$: `mpg` (0.90), `wt` (â€“0.87), `qsec` (0.60) â€“ sugeruje, Å¼e pierwsza
    zmienna kanoniczna opisuje zwiÄ…zek miÄ™dzy cechami silnika a zuÅ¼yciem paliwa
    i masÄ… pojazdu.

`CV 1` wskazuje na silnÄ… zaleÅ¼noÅ›Ä‡ miÄ™dzy masÄ… i mocÄ… samochodu (cechy
techniczne) a jego ekonomiÄ… (`mpg`) i osiÄ…gami (`qsec`). WiÄ™ksze silniki sÄ…
zwiÄ…zane z wiÄ™kszÄ… masÄ… i spalaniem (niÅ¼szym `mpg`).

`CV 2`

-   Dla $X$: `disp` (â€“0.90), `hp` (1.06), `drat` (0.41), `vs` (â€“0.67) â€“
    wskazuje na kontrast miÄ™dzy mocÄ… (`hp`) a objÄ™toÅ›ciÄ… i ukÅ‚adem silnika
    (`vs`).
-   Dla $Y$: `gear` (0.52), `am` (0.27) â€“ wartoÅ›ci `CV 2` rosnÄ… przy wyÅ¼szej
    liczbie biegÃ³w i skrzyni manualnej.

JednoczeÅ›nie Å‚adunki strukturalne pokazujÄ…, Å¼e

-   $X$: `drat` (0.50), `hp` (0.38), `vs` (â€“0.36) â€“ umiarkowane korelacje.
-   $Y$: `gear` (0.79), `am` (0.73), `qsec` (â€“0.74) â€“ pokazuje powiÄ…zanie ze
    skrzyniÄ… biegÃ³w i czasem przyspieszenia.

`CV 2` odzwierciedla typ skrzyni biegÃ³w i dynamikÄ™ pojazdu. Samochody z wiÄ™kszÄ…
liczbÄ… biegÃ³w i skrzyniÄ… manualnÄ… majÄ… inne cechy napÄ™du niÅ¼ te z
automatem[^cca-7].

InterpretacjÄ™ pozostaÅ‚ych par kanonicznych pominiÄ™to, ze wzgledu na brak
istotnoÅ›ci statystycznej.

Interpretacja adekwatnoÅ›ci zmiennych kanonicznych (ang. *Canonical Variate
Adequacies*) polega na ocenie, w jakim stopniu kaÅ¼da z kanonicznych zmiennych
$U_k$ i $V_k$ wyjaÅ›nia wariancjÄ™ oryginalnych zmiennych w swoim zbiorze
(odpowiednio: $X$ lub $Y$). WskaÅºniki te sÄ… interpretowane jako miara
â€reprezentatywnoÅ›ciâ€ danej zmiennej kanonicznej wzglÄ™dem zmiennych pierwotnych.

`CV 1`

Dla zbioru $X$, pierwsza zmienna kanoniczna $U_1$ wyjaÅ›nia 76,2% caÅ‚kowitej
wariancji zmiennych pierwotnych. Oznacza to, Å¼e kombinacja liniowa $U_1$ bardzo
dobrze reprezentuje gÅ‚Ã³wny wymiar zrÃ³Å¼nicowania zmiennych $X$ (np. liczby
cylindrÃ³w, pojemnoÅ›ci silnika, mocy itd.). Wysoka adekwatnoÅ›Ä‡ wskazuje, Å¼e
$U_1$ zawiera wiÄ™kszoÅ›Ä‡ informacji zawartej w zmiennych $X$. Dla zbioru $Y$,
odpowiadajÄ…ca zmienna kanoniczna $V_1$ wyjaÅ›nia 49,4% wariancji zmiennych
pierwotnych. Jest to rÃ³wnieÅ¼ stosunkowo wysoka wartoÅ›Ä‡, co oznacza, Å¼e $V_1$
dobrze streszcza informacje ze zbioru $Y$ (`mpg`, `qsec`, `wt`, `gear`, `am`).
Zatem pierwsza para zmiennych kanonicznych $(U_1, V_1)$ nie tylko ma bardzo
wysokÄ… korelacjÄ™ wzajemnÄ…, ale rÃ³wnieÅ¼ silnie reprezentuje oba zbiory
zmiennych, co czyni jÄ… interpretacyjnie bardzo istotnÄ….

`CV 2`

Dla zbioru $X$, zmienna $U_2$ wyjaÅ›nia 11,1% wariancji. Jest to znacznie mniej
niÅ¼ w przypadku $U_1$, ale nadal moÅ¼e wskazywaÄ‡ na pewnÄ… drugorzÄ™dnÄ… strukturÄ™
w danych $X$, np. kontrast miÄ™dzy rÃ³Å¼nymi cechami napÄ™du lub parametrÃ³w
konstrukcyjnych pojazdu. Dla zbioru $Y$, zmienna $V_2$ wyjaÅ›nia 36,2%
wariancji, co stanowi wartoÅ›Ä‡ umiarkowanÄ…. MoÅ¼e to oznaczaÄ‡, Å¼e $V_2$
reprezentuje odrÄ™bny wymiar zrÃ³Å¼nicowania w danych $Y$, byÄ‡ moÅ¼e zwiÄ…zany z
typem skrzyni biegÃ³w lub przyspieszeniem. Druga para zmiennych kanonicznych
tÅ‚umaczy mniejszÄ…, ale nadal znaczÄ…cÄ… czÄ™Å›Ä‡ zmiennoÅ›ci zmiennych pierwotnych,
zwÅ‚aszcza po stronie $Y$. MoÅ¼e wiÄ™c ujawniaÄ‡ dodatkowe, mniej oczywiste
powiÄ…zania miÄ™dzy cechami konstrukcyjnymi a wÅ‚aÅ›ciwoÅ›ciami uÅ¼ytkowymi
samochodÃ³w.

WskaÅºniki *redundancji kanonicznej* informujÄ… o tym, ile przeciÄ™tnej wariancji
w jednym zbiorze zmiennych jest wyjaÅ›nione przez kombinacjÄ™ liniowÄ… zmiennych
kanonicznych utworzonÄ… na podstawie drugiego zbioru. Jest to zatem miara
uÅ¼ytecznoÅ›ci jednej grupy zmiennych do przewidywania drugiej, z uwzglÄ™dnieniem
zarÃ³wno siÅ‚y korelacji kanonicznej, jak i struktury wariancji wewnÄ…trz zbiorÃ³w.
Redundancja stanowi produkt odpowiedniego wspÃ³Å‚czynnika korelacji kanonicznej
podniesionego do kwadratu i wspÃ³Å‚czynnika adekwatnoÅ›ci (czyli wyjaÅ›nionej
wariancji).

Redundancja $X|Y$ okreÅ›la, jak dobrze zmienne kanoniczne ze zbioru $Y$ (czyli
$V_1, V_2, \ldots$) pozwalajÄ… wyjaÅ›niÄ‡ zmiennoÅ›Ä‡ w zbiorze $X$.

-   `CV 1` - wartoÅ›Ä‡ 0.712 oznacza, Å¼e okoÅ‚o 71,2% wariancji zmiennych ze
    zbioru $X$ moÅ¼na wyjaÅ›niÄ‡ na podstawie pierwszej zmiennej kanonicznej $V_1$
    (utworzonej ze zmiennych $Y$). Jest to bardzo wysoka wartoÅ›Ä‡ i Å›wiadczy o
    duÅ¼ej nadmiarowoÅ›ci informacji miÄ™dzy zbiorami â€“ zmienne z $Y$ dobrze
    â€reprezentujÄ…â€ $X$.
-   `CV 2` - wartoÅ›Ä‡ 0.081 oznacza, Å¼e druga zmienna kanoniczna ze zbioru $Y$
    wyjaÅ›nia juÅ¼ tylko 8,1% wariancji zbioru $X$. To wyraÅºnie mniejszy wkÅ‚ad,
    ale moÅ¼e wciÄ…Å¼ wskazywaÄ‡ na drugorzÄ™dne zwiÄ…zki pomiÄ™dzy niektÃ³rymi
    zmiennymi w obu zbiorach.

Redundancja $Y|X$ okreÅ›la, jak dobrze zmienne kanoniczne ze zbioru $X$ (czyli
$U_1, U_2, \ldots$) pozwalajÄ… wyjaÅ›niÄ‡ zmiennoÅ›Ä‡ w zbiorze $Y$.

-   `CV 1` - wartoÅ›Ä‡ 0.461 oznacza, Å¼e pierwsza zmienna kanoniczna $U_1$
    wyjaÅ›nia 46,1% wariancji zbioru $Y$. To wynik dobry, choÄ‡ mniej
    spektakularny niÅ¼ w przypadku $X | Y$, co moÅ¼e sugerowaÄ‡, Å¼e zbiÃ³r $X$
    (cechy konstrukcyjne pojazdÃ³w) zawiera mniej informacji o cechach
    uÅ¼ytkowych i osiÄ…gach niÅ¼ odwrotnie.
-   `CV 2` - wartoÅ›Ä‡ 0.264 oznacza, Å¼e druga zmienna kanoniczna $U_2$ wyjaÅ›nia
    26,4% wariancji zmiennych w $Y$. To umiarkowany wkÅ‚ad i Å›wiadczy o
    obecnoÅ›ci wyraÅºnej, ale sÅ‚abszej drugiej osi powiÄ…zaÅ„ miÄ™dzy zbiorami.

Ponadto:

-   CaÅ‚kowita redundancja $X|Y = 0.809$, co oznacza, Å¼e zbiÃ³r $Y$ pozwala
    Å‚Ä…cznie wyjaÅ›niÄ‡ aÅ¼ 81% wariancji zmiennych z $X$ na podstawie wszystkich
    kanonicznych zmiennych $V_k$.
-   CaÅ‚kowita redundancja $Y|X = 0.748$, co oznacza, Å¼e zmienne z $X$ pozwalajÄ…
    wyjaÅ›niÄ‡ 75% wariancji w zbiorze $Y$.

Pierwsza para zmiennych kanonicznych jest zdecydowanie najistotniejsza,
wyjaÅ›niajÄ…c wiÄ™kszoÅ›Ä‡ wspÃ³lnej struktury. Wysoka redundancja Å›wiadczy o silnym
powiÄ…zaniu miÄ™dzy zbiorami zmiennych, szczegÃ³lnie miÄ™dzy konstrukcjÄ… pojazdu
$X$ a jego osiÄ…gami i wyposaÅ¼eniem $Y$. Druga zmienna kanoniczna wnosi mniej
informacji, ale nadal ma interpretacyjnÄ… wartoÅ›Ä‡. PowyÅ¼ej drugiej pary,
wartoÅ›ci stajÄ… siÄ™ bardzo niskie, co sugeruje, Å¼e kolejne zmienne kanoniczne
nie dostarczajÄ… juÅ¼ istotnych zaleÅ¼noÅ›ci.
:::

[^cca-7]: Wagi kanoniczne (*Canonical Variate Coefficients*) pokazujÄ…, jak
    zmienne pierwotne sÄ… **waÅ¼one w kombinacji liniowej** tworzÄ…cej zmiennÄ…
    kanonicznÄ…. Oznacza to, Å¼e dana zmienna ma okreÅ›lonÄ… kontrybucjÄ™ do wyniku
    przy jednoczesnym uwzglÄ™dnieniu obecnoÅ›ci wszystkich pozostaÅ‚ych zmiennych
    w modelu. Innymi sÅ‚owy, wagi sÄ… wynikiem rozwiÄ…zania problemu
    optymalizacji, w ktÃ³rym maksymalizujemy korelacjÄ™ miÄ™dzy dwiema
    kombinacjami liniowymi ($a'X$ i $b'Y$), i odzwierciedlajÄ… wzglÄ™dny wpÅ‚yw
    danej zmiennej **w kontekÅ›cie wspÃ³Å‚dziaÅ‚ania z innymi zmiennymi**. Åadunki
    kanoniczne (*loadings*) natomiast opisujÄ… zwykÅ‚Ä… korelacjÄ™ miÄ™dzy zmiennÄ…
    kanonicznÄ… a kaÅ¼dÄ… pojedynczÄ… zmiennÄ… oryginalnÄ…, czyli **bez kontroli
    pozostaÅ‚ych zmiennych**. W tym sensie sÄ… one bliÅ¼sze klasycznej
    interpretacji wspÃ³Å‚czynnikÃ³w korelacji, ktÃ³re pokazujÄ…, jak silnie dana
    zmienna jest â€powiÄ…zanaâ€ z kanonicznym wymiarem, ale juÅ¼ nie informujÄ…,
    jaka byÅ‚a jej rzeczywista kontrybucja do utworzenia kombinacji liniowej.
    Dlatego moÅ¼liwe sÄ… sytuacje, w ktÃ³rych zmienna ma niski wspÃ³Å‚czynnik wagowy
    (jej udziaÅ‚ w kombinacji jest maÅ‚y lub nawet ujemny), ale mimo to jej
    korelacja z uzyskanym wymiarem kanonicznym jest wysoka â€“ bo zmienna ta
    silnie podÄ…Å¼a za ogÃ³lnÄ… strukturÄ… zaleÅ¼noÅ›ci w zbiorze. To wÅ‚aÅ›nie
    obserwujemy w `CV 2`. Na przykÅ‚ad `disp` ma duÅ¼Ä… ujemnÄ… wagÄ™ (â€“0.90), co
    oznacza, Å¼e wnosi istotny wkÅ‚ad w kombinacjÄ™ liniowÄ… $U_2$, ale
    jednoczeÅ›nie jej Å‚adunek jest tylko â€“0.17, czyli korelacja ze zmiennÄ…
    kanonicznÄ… jest umiarkowana (moÅ¼e siÄ™ zdarzyÄ‡, Å¼e bÄ™dzie nawet przeciwna).
    Oznacza to, Å¼e w obecnoÅ›ci innych zmiennych, szczegÃ³lnie takich jak `hp`
    czy `drat`, `disp` jest â€wymuszonyâ€ do peÅ‚nienia okreÅ›lonej roli w
    kombinacji liniowej, mimo Å¼e jego indywidualna korelacja z $U_2$ jest
    mniejsza.
