<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pl" xml:lang="pl"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Metody redukcji wymiarowości – Wielowymiarowa analiza danych</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./sem.html" rel="prev">
<link href="./images/cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-bc185b5c5bdbcb35c2eb49d8a876ef70.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-2d449610c6da6b3fd31ed0a9984c1b47.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-f7ccbded210020a5533f6fd86e3f20c2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-2d449610c6da6b3fd31ed0a9984c1b47.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Brak wyników",
    "search-matching-documents-text": "dopasowane dokumenty",
    "search-copy-link-title": "Kopiuj link do wyszukiwania",
    "search-hide-matches-text": "Ukryj dodatkowe dopasowania",
    "search-more-match-text": "więcej dopasowań w tym dokumencie",
    "search-more-matches-text": "więcej dopasowań w tym dokumencie",
    "search-clear-button-title": "Wyczyść",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Anuluj",
    "search-submit-button-title": "Zatwierdź",
    "search-label": "Szukaj"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Przełącz pasek boczny" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./pca.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Metody redukcji wymiarowości</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Przełącz pasek boczny" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Szukaj" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/logo.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Wielowymiarowa analiza danych</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/DariuszMajerek/WAD_new" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/intent/tweet?url=%7Curl%7C" title="Twitter" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Przełącz tryb ciemny"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Przełącz tryb czytnika">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Szukaj"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wstęp</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multi_tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Testy wielowymiarowe</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Analiza kanoniczna</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Analiza czynnikowa</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Modele strukturalne</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pca.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Metody redukcji wymiarowości</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Literatura</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Spis treści</h2>
   
  <ul>
<li>
<a href="#pca" id="toc-pca" class="nav-link active" data-scroll-target="#pca">PCA</a>
  <ul class="collapse">
<li><a href="#matematyczna-definicja-modelu" id="toc-matematyczna-definicja-modelu" class="nav-link" data-scroll-target="#matematyczna-definicja-modelu">Matematyczna definicja modelu</a></li>
  <li><a href="#za%C5%82o%C5%BCenia-modelu" id="toc-założenia-modelu" class="nav-link" data-scroll-target="#za%C5%82o%C5%BCenia-modelu">Założenia modelu</a></li>
  <li><a href="#interpretacja-graficzna-i-praktyczna" id="toc-interpretacja-graficzna-i-praktyczna" class="nav-link" data-scroll-target="#interpretacja-graficzna-i-praktyczna">Interpretacja graficzna i praktyczna</a></li>
  <li><a href="#kryteria-doboru-liczby-sk%C5%82adowych-g%C5%82%C3%B3wnych" id="toc-kryteria-doboru-liczby-składowych-głównych" class="nav-link" data-scroll-target="#kryteria-doboru-liczby-sk%C5%82adowych-g%C5%82%C3%B3wnych">Kryteria doboru liczby składowych głównych</a></li>
  </ul>
</li>
  <li><a href="#ica" id="toc-ica" class="nav-link" data-scroll-target="#ica">ICA</a></li>
  <li>
<a href="#mds" id="toc-mds" class="nav-link" data-scroll-target="#mds">MDS</a>
  <ul class="collapse">
<li><a href="#wersja-metryczna-klasyczna-mds" id="toc-wersja-metryczna-klasyczna-mds" class="nav-link" data-scroll-target="#wersja-metryczna-klasyczna-mds">Wersja metryczna (klasyczna MDS)</a></li>
  <li><a href="#wersja-niemetryczna-non-metric-mds" id="toc-wersja-niemetryczna-non-metric-mds" class="nav-link" data-scroll-target="#wersja-niemetryczna-non-metric-mds">Wersja niemetryczna (Non-metric MDS)</a></li>
  <li><a href="#por%C3%B3wnanie-metod-mds" id="toc-porównanie-metod-mds" class="nav-link" data-scroll-target="#por%C3%B3wnanie-metod-mds">Porównanie metod MDS</a></li>
  </ul>
</li>
  <li><a href="#t-sne" id="toc-t-sne" class="nav-link" data-scroll-target="#t-sne">t-SNE</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/DariuszMajerek/WAD_new/issues/new" class="toc-action"><i class="bi bi-github"></i>Zgłoś problem</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span class="chapter-title">Metody redukcji wymiarowości</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Historia metod redukcji wymiarowości jest ściśle związana z rozwojem statystyki, psychometrii, a następnie uczenia maszynowego i eksploracji danych. Już na początku XX wieku zaczęto poszukiwać narzędzi pozwalających na uproszczenie złożonych zbiorów danych, w których liczba zmiennych była zbyt duża, aby dało się je analizować bezpośrednio. Głównym celem było uchwycenie istotnych wzorców i zależności przy zachowaniu możliwie dużej ilości informacji.</p>
<p>Jednym z pierwszych i do dziś najczęściej stosowanych podejść jest analiza głównych składowych (<em>Principal Component Analysis</em>, PCA). Jej początki sięgają pracy Karla Pearsona z 1901 roku, który zaproponował metodę znajdowania „linii najlepszego dopasowania” w przestrzeni wielowymiarowej. Została ona następnie rozwinięta przez Harolda Hotellinga w latach 30. XX wieku, który sformalizował PCA jako metodę przekształcania skorelowanych zmiennych w nowy zbiór nieskorelowanych składowych, uporządkowanych według wariancji. PCA szybko znalazła zastosowanie w psychometrii i naukach społecznych, a następnie w genetyce, obrazowaniu i ekonomii.</p>
<p>W latach powojennych, wraz z rozwojem psychologii eksperymentalnej i neuronauk, pojawiła się potrzeba metod lepiej uchwytujących niezależne źródła sygnału. Doprowadziło to do opracowania analizy niezależnych składowych (<em>Independent Component Analysis</em>, ICA). Choć koncepcje matematyczne stojące za ICA sięgają teorii informacji z połowy XX wieku, to metoda została sformalizowana dopiero w latach 80. i 90. XX wieku, m.in. dzięki pracom Jeana-Françoisa Cardoso czy Aapa Hyvärinena. ICA stała się niezwykle użyteczna w problemach takich jak separacja źródeł w sygnałach biomedycznych (np. EEG, fMRI), odszumianie danych czy analiza obrazów.</p>
<p>Równolegle rozwijały się metody oparte na odległościach i podobieństwach, takie jak skalowanie wielowymiarowe (<em>Multidimensional Scaling</em>, MDS). Pierwsze idee pojawiły się w psychometrii w latach 50., a szczególnie w pracach Torgersona i Kruskala. Celem MDS było odwzorowanie obiektów opisanych macierzą podobieństw lub odległości w przestrzeni niskowymiarowej w taki sposób, aby zachować relacje strukturalne. Metoda ta znalazła szerokie zastosowanie w badaniach percepcji, marketingu, biologii oraz w analizie sieci społecznych.</p>
<p>Od końca XX wieku rozwój metod redukcji wymiarowości przyspieszył, co było związane z eksplozją danych wysokowymiarowych w biologii molekularnej, informatyce czy analizie obrazów. Oprócz klasycznych metod liniowych zaczęto rozwijać techniki nieliniowe, takie jak t-SNE (2008, Laurens van der Maaten i Geoffrey Hinton) czy UMAP (2018, McInnes, Healy i Melville), które pozwalają zachować lokalne struktury danych w niskowymiarowej przestrzeni wizualizacji. Metody te zrewolucjonizowały analizę danych w uczeniu maszynowym i biologii obliczeniowej, np. w analizie danych pojedynczych komórek.</p>
<p>Dziś redukcja wymiarowości jest nie tylko techniką wspomagającą wizualizację danych, lecz także kluczowym elementem przetwarzania wstępnego w wielu modelach uczenia maszynowego. Od klasycznych metod PCA i MDS po nowoczesne techniki oparte na sieciach neuronowych, takie jak autoenkodery, rozwój tego obszaru odzwierciedla rosnącą potrzebę uproszczenia i interpretacji złożoności współczesnych danych.</p>
<section id="pca" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="pca">PCA</h2>
<section id="matematyczna-definicja-modelu" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="matematyczna-definicja-modelu">Matematyczna definicja modelu</h3>
<p>Punktem wyjścia analizy głównych składowych jest problem odwzorowania wielowymiarowego zbioru danych w przestrzeni o mniejszej liczbie wymiarów przy możliwie minimalnej stracie informacji. W praktyce dąży się do kompresji i odszumiania sygnału, usuwania współliniowości, stabilizacji dalszych modeli (np. regresji), a także do wizualizacji struktur klasowych i gradientów zmienności. Przykładowo, dla dwóch silnie skorelowanych cech pierwsza składowa główna jest skierowana wzdłuż linii największego rozrzutu (blisko prostej <span class="math inline">\(y \approx x\)</span>), a redukcja do jednego wymiaru zachowuje większą część wariancji niż dowolna inna projekcja.</p>
<p>Matematyczna definicja poprzez maksymalizację wariancji i dekompozycję spektralną polega na transformacji scentralizowanej macierzy danych <span class="math inline">\(X \in \mathbb{R}^{n\times p}\)</span> (każdą kolumnę odjąć o jej średnią). Niech <span class="math inline">\(\Sigma=\frac{1}{n-1}X^\top X\)</span> oznacza empiryczną macierz kowariancji. Pierwszą składową wyznaczamy jako kierunek <span class="math inline">\(w\in\mathbb{R}^{p}\)</span> rozwiązujący zadanie maksymalizacji wariancji projekcji, czyli maksymalizacji <span class="math inline">\(\mathrm{Var}(Xw)=w^\top\Sigma w\)</span> przy ograniczeniu <span class="math inline">\(\|w\|_{2}=1\)</span>. Zastosowanie mnożników Lagrange’a prowadzi do warunku stacjonarności <span class="math inline">\(\Sigma w=\lambda w\)</span>, a więc <span class="math inline">\(w\)</span> jest wektorem własnym <span class="math inline">\(\Sigma\)</span>, zaś <span class="math inline">\(\lambda\)</span> jest odpowiadającą mu wartością własną. Wybieramy największą wartość własną <span class="math inline">\(\lambda_{1}\)</span> i jej wektor <span class="math inline">\(w_{1}\)</span>, wówczas wariancja pierwszych wyników projekcji <span class="math inline">\(z_{1}=Xw_{1}\)</span> równa się <span class="math inline">\(\lambda_{1}\)</span>. Kolejne składowe otrzymujemy analogicznie jako rozwiązania tego samego problemu z dodatkowymi ograniczeniami ortogonalności <span class="math inline">\(w_{j}^\top w_{k}=0\)</span> dla <span class="math inline">\(k&lt;j\)</span>, co ustawia kolejne wektory własne <span class="math inline">\(\Sigma\)</span> w porządku malejących wartości własnych <span class="math inline">\(\lambda_{1}\ge \lambda_{2}\ge \dots \ge \lambda_{p}\)</span>. Wektor wyników projekcji <span class="math inline">\(z_{j}\)</span> nazywamy w praktyce <em>scores</em>, a <span class="math inline">\(w_{j}\)</span> — wektorem ładunków (<em>loadings</em>). Kumulatywny udział wariancji wyjaśnianej przez pierwsze <span class="math inline">\(k\)</span> składowych wynosi wówczas <span class="math inline">\(\sum_{j=1}^{k}\lambda_{j}\big/\sum_{j=1}^{p}\lambda_{j}\)</span> i służy na często do doboru <span class="math inline">\(k\)</span>.</p>
<p>Równoważne wyprowadzenie modelu przez rozkład na wartości osobliwe, czyli SVD (ang. <em>Singular Value Decomposition</em>), opiera się na faktoryzacji <span class="math inline">\(X=UDV^\top\)</span>, gdzie <span class="math inline">\(U\in\mathbb{R}^{n\times r}\)</span> i <span class="math inline">\(V\in\mathbb{R}^{p\times r}\)</span> mają ortonormalne kolumny, <span class="math inline">\(D=\mathrm{diag}(d_{1},\dots,d_{r})\)</span> zawiera uporządkowane wartości osobliwe <span class="math inline">\(d_{1}\ge \dots \ge d_{r}&gt;0\)</span>, a <span class="math inline">\(r=\mathrm{rank}(X)\)</span>. Wówczas kolumny <span class="math inline">\(V\)</span> pokrywają się (co do znaku) z wektorami ładunków <span class="math inline">\(w_{j}\)</span>, zaś macierz wyników projekcji <span class="math inline">\(T=XV\)</span> równa się <span class="math inline">\(UD\)</span>. Związek między oboma podejściami jest ścisły: <span class="math inline">\(\lambda_{j}=d_{j}^{2}/(n-1)\)</span>, a więc wariancje składowych odwzorowuje się przez kwadraty wartości osobliwych przeskalowane czynnikiem <span class="math inline">\(1/(n-1)\)</span>. Projekcja do <span class="math inline">\(k\)</span> wymiarów przyjmuje wówczas postać <span class="math inline">\(X\mapsto T_{k}=UD_{k}\)</span>, a rekonstrukcja rzędu <span class="math inline">\(k\)</span> ma postać <span class="math display">\[
X_{k}=T_{k}V_{k}^\top=U_{k}D_{k}V_{k}^\top.
\]</span> Z twierdzenia Eckarta–Younga–Mirsky’ego wynika, że <span class="math inline">\(X_{k}\)</span> minimalizuje błąd Frobeniusa <span class="math inline">\(\|X-Y\|_{F}\)</span> w klasie macierzy <span class="math inline">\(Y\)</span> o rządzie co najwyżej <span class="math inline">\(k\)</span>, czyli PCA daje najlepszą aproksymację niskorangową w sensie średniokwadratowym (jest to tzw. obcięte SVD). Ta równoważność łączyć dwie intuicje: maksymalizacja przechwyconej wariancji i minimalizacja błędu rekonstrukcji.</p>
<div id="thm-1" class="theorem page-columns page-full">
<p><span class="theorem-title"><strong>Twierdzenie 5.1 (Twierdzenie Eckarta–Younga–Mirsky)</strong></span> Niech <span class="math inline">\(X\in\mathbb{R}^{n\times p}\)</span> i niech <span class="math inline">\(r=\mathrm{rank}(X)\)</span>. Dla <span class="math inline">\(k&lt;r\)</span> niech <span class="math inline">\(X_{k}=U_{k}D_{k}V_{k}^\top\)</span> będzie obciętym rozkładem SVD rzędu <span class="math inline">\(k\)</span>. Wówczas <span class="math inline">\(X_{k}\)</span> jest jedyną macierzą o <span class="math inline">\(\mathrm{rank}(X_{k})=k\)</span>, która minimalizuje błąd Frobeniusa<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span class="math inline">\(\|X-Y\|_{F}\)</span> w klasie macierzy <span class="math inline">\(Y\in\mathbb{R}^{n\times p}\)</span> o <span class="math inline">\(\mathrm{rank}(Y)\le k\)</span>. Ponadto zachodzi równość <span class="math inline">\(\|X-X_{k}\|_{F}^{2}=\sum_{j=k+1}^{r}d_{j}^{2}\)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Błąd Frobeniusa <span class="math inline">\(\|A\|_{F}\)</span> macierzy <span class="math inline">\(A\)</span> definiujemy jako <span class="math inline">\(\|A\|_{F}=\sqrt{\sum_{i,j}a_{ij}^{2}}=\sqrt{\mathrm{tr}(A^\top A)}.\)</span></p></div></div></div>
<p>Zadania optymalizacyjne wyraża się zarówno w wersji wektorowej, jak i macierzowej. Dla pierwszej składowej rozwiązujemy problem maksymalizacji <span class="math inline">\(w^\top\Sigma\)</span> w przy <span class="math inline">\(\|w\|_{2}=1\)</span>, co prowadzi do największej wartości własnej. Dla <span class="math inline">\(k\)</span> składowych poszukujemy macierzy <span class="math inline">\(W\in\mathbb{R}^{p\times k}\)</span> o kolumnach ortonormalnych, która maksymalizuje <span class="math inline">\(\mathrm{tr}(W^\top\Sigma W)\)</span>, skąd wynika wybór <span class="math inline">\(k\)</span> wektorów własnych <span class="math inline">\(\Sigma\)</span>. Równoważnie, szukamy projekcji <span class="math inline">\(P=WW^\top\)</span> minimalizującej błąd rekonstrukcji <span class="math inline">\(\|X-XWW^\top\|_{F}^{2}\)</span>. W notacji SVD rozwiązanie ma postać <span class="math inline">\(W=V_{k}\)</span>, a więc projekcja działa przez mnożenie przez <span class="math inline">\(V_{k}V_{k}^\top\)</span>.</p>
<p>Gdy cechy mierzymy w różnych jednostkach i skalach, zaleca się stosować macierz korelacji zamiast kowariancji, co jest równoważne standaryzacji kolumn <span class="math inline">\(X\)</span> do wariancji 1. Wiele implementacji (np. w <code>R</code> funkcja <code>prcomp</code>) wykorzystuje SVD na scentralizowanych i ewentualnie standaryzowanych danych, co zapewniać numeryczną stabilność, zwłaszcza gdy <span class="math inline">\(p\gg n\)</span>. W sytuacji <span class="math inline">\(p\gg n\)</span> korzystniejsze bywa liczenie mniejszych rozkładów: albo dual PCA<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> na macierzy <span class="math inline">\(XX^\top\in\mathbb{R}^{n\times n}\)</span>, albo bezpośrednio obciętego SVD. Dla danych zaburzonych wartościami odstającymi rozważa się wersje odporne, np. zastępuje się <span class="math inline">\(\Sigma\)</span> estymatorem odpornym (ang. <em>Minimum Covariance Determinant</em>, MCD)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> lub stosuje się <em>robust</em> PCA i dekompozycje oparte na normie jądra i normie <span class="math inline">\(L_{1}\)</span><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Wówczas wektory własne <span class="math inline">\(\tilde{w}_{j}\)</span> macierzy <span class="math inline">\(XX^\top\in\mathbb{R}^{n\times n}\)</span> (która jest niższego wymiaru niż <span class="math inline">\(X^\top X\)</span> a co za tym idzie lepiej się zachowuje numerycznie) przekształca się w wektory własne <span class="math inline">\(\Sigma\)</span> przez <span class="math inline">\(w_{j}=X^\top \tilde{w}_{j}/\sqrt{(n-1)\tilde{\lambda}_{j}}\)</span>, gdzie <span class="math inline">\(\tilde{\lambda}_{j}\)</span> jest odpowiadającą wartością własną.</p></div><div id="fn3"><p><sup>3</sup>&nbsp;Estymator MCD polega na znalezieniu podzbioru <span class="math inline">\(h\)</span> obserwacji (zwykle <span class="math inline">\(h \approx 0.75 n\)</span>) o najmniejszym wyznaczniku macierzy kowariancji, a następnie obliczeniu średniej i kowariancji na tym podzbiorze. Jest odporny na wartości odstające, ponieważ ignoruje obserwacje, które znacznie zwiększają wyznacznik.</p></div><div id="fn4"><p><sup>4</sup>&nbsp;Metoda ta zakłada, że macierz danych <span class="math inline">\(X\)</span> ma postać <span class="math inline">\(X=L+S+E\)</span>, gdzie <span class="math inline">\(L\)</span> jest macierzą niskorangową (sygnał), <span class="math inline">\(S\)</span> jest macierzą rzadką (wartości odstające), a <span class="math inline">\(E\)</span> jest szumem o małej wariancji. Celem jest odzyskanie <span class="math inline">\(L\)</span> poprzez minimalizację funkcji celu <span class="math inline">\(\|L\|_{*}+\lambda\|S\|_{1}\)</span> przy ograniczeniu <span class="math inline">\(X=L+S\)</span>, gdzie <span class="math inline">\(\|L\|_{*}\)</span> jest normą jądra (suma wartości osobliwych <span class="math inline">\(L\)</span>), a <span class="math inline">\(\|S\|_{1}\)</span> jest normą <span class="math inline">\(L_{1}\)</span> macierzy <span class="math inline">\(S\)</span>.</p></div></div><p>Podsumowując, PCA można sformułować trojako: jako maksymalizację wariancji projekcji przy ograniczeniach ortogonalności, jako dekompozycję spektralną macierzy kowariancji oraz jako obcięte SVD zapewniające najlepszą aproksymację niskorangową.</p>
</section><section id="założenia-modelu" class="level3"><h3 class="anchored" data-anchor-id="założenia-modelu">Założenia modelu</h3>
<p>Założenia dotyczące danych wejściowych do analizy głównych składowych (PCA) są stosunkowo słabe, ale mają istotny wpływ na jakość wyników i interpretację. Można je podzielić na kilka grup:</p>
<ol type="1">
<li>Struktura danych
<ul>
<li>Liniowość – PCA zakłada, że główne wzorce zmienności w danych można uchwycić przez liniowe kombinacje zmiennych wejściowych. Jeśli zależności są silnie nieliniowe (np. dane leżą na zakrzywionej rozmaitości), PCA nie odwzoruje ich poprawnie – lepiej wtedy stosować <em>kernel</em> PCA albo metody sąsiedztwa (np. t-SNE, UMAP).</li>
<li>Współzależność zmiennych – metoda ma sens tylko wtedy, gdy między cechami istnieją korelacje. Jeśli wszystkie zmienne są niezależne, PCA nie zredukuje wymiarów i każda składowa odpowiadać będzie jednej zmiennej.</li>
</ul>
</li>
<li>Jednostki i skale pomiarowe
<ul>
<li>PCA jest wrażliwa na skalę zmiennych, ponieważ opiera się na wariancji.</li>
<li>Jeśli cechy mierzone są w różnych jednostkach (np. temperatura w °C i masa w kg), należy je standaryzować (np. do średniej 0 i wariancji 1).</li>
<li>Gdy wszystkie cechy są w tej samej skali, można pracować na macierzy kowariancji; w przeciwnym razie lepiej korzystać z macierzy korelacji.</li>
</ul>
</li>
<li>Rozkład danych
<ul>
<li>Normalność wielowymiarowa nie jest wymagana, ale jeżeli dane mają rozkład wielowymiarowo normalny, to składowe główne są niezależne (nie tylko nieskorelowane), co upraszcza interpretację. Naruszenie założenia o normalności nie sprawia, że PCA nie działa, lecz niezależność składowych nie jest zagwarantowana.</li>
<li>Brak wartości odstających – PCA jest bardzo wrażliwa na <em>outliery</em>, które mogą wpłynąć na kierunki głównych składowych, bo opiera się na kowariancji. Dlatego dane powinny być oczyszczone lub należy stosować wersje metody odporne (<em>robust</em> PCA).</li>
</ul>
</li>
<li>Liczebność próby
<ul>
<li>Aby oszacować macierz kowariancji, liczba obserwacji <span class="math inline">\(n\)</span> powinna być odpowiednio duża względem liczby zmiennych <span class="math inline">\(p\)</span>.</li>
<li>Gdy <span class="math inline">\(p \gg n\)</span>, klasyczna PCA bywa niestabilna i stosuje się wtedy <em>dual</em> PCA albo obcięte SVD.</li>
</ul>
</li>
<li>Braki danych - PCA wymaga pełnej macierzy danych (bez braków). W przypadku braków stosuje się najczęściej imputację (np. metodą średnich czy metody oparte na modelach).</li>
</ol></section><section id="interpretacja-graficzna-i-praktyczna" class="level3"><h3 class="anchored" data-anchor-id="interpretacja-graficzna-i-praktyczna">Interpretacja graficzna i praktyczna</h3>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Pakiety</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">44</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1) Dane 2D o eliptycznym rozkładzie (silna współzmienność)</span></span>
<span><span class="va">n</span>  <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">sd1</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">sd2</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sd1</span><span class="op">^</span><span class="fl">2</span>, <span class="va">rho</span><span class="op">*</span><span class="va">sd1</span><span class="op">*</span><span class="va">sd2</span>,</span>
<span>                  <span class="va">rho</span><span class="op">*</span><span class="va">sd1</span><span class="op">*</span><span class="va">sd2</span>, <span class="va">sd2</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="va">n</span>, mu <span class="op">=</span> <span class="va">mu</span>, Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span>.name_repair <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1"</span>,<span class="st">"x2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2) PCA na danych scentralizowanych (bez standaryzacji)</span></span>
<span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">X</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wartości własne i wektory (ładunki)</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="va">pca</span><span class="op">$</span><span class="va">rotation</span>    <span class="co"># kolumny: PC1, PC2</span></span>
<span><span class="va">center</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3) Punkty końcowe wektorów PC1 i PC2 (skalować długością ~ odchylenie wzdłuż składowej)</span></span>
<span><span class="co"># Skala wektora: k * sd wzdłuż danej składowej (tu k = 2 dla czytelności)</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">pc1_end</span> <span class="op">&lt;-</span> <span class="va">center</span> <span class="op">+</span> <span class="va">k</span> <span class="op">*</span> <span class="va">pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">V</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">pc2_end</span> <span class="op">&lt;-</span> <span class="va">center</span> <span class="op">+</span> <span class="va">k</span> <span class="op">*</span> <span class="va">pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">V</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># 4) Ramy wykresu i linie osi oryginalnego układu</span></span>
<span><span class="va">xr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span>; <span class="va">yr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">x2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5) Dane pomocnicze do geometrii</span></span>
<span><span class="va">arrows_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">x</span>,          <span class="op">~</span><span class="va">y</span>,          <span class="op">~</span><span class="va">xend</span>,        <span class="op">~</span><span class="va">yend</span>,     <span class="op">~</span><span class="va">label</span>,</span>
<span>  <span class="va">center</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,   <span class="va">center</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,   <span class="va">pc1_end</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,   <span class="va">pc1_end</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"PC1"</span>,</span>
<span>  <span class="va">center</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,   <span class="va">center</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,   <span class="va">pc2_end</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,   <span class="va">pc2_end</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"PC2"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Opisy udziału wariancji</span></span>
<span><span class="va">expl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">lambda</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>, accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6) Wykres</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">X</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x1</span>, y <span class="op">=</span> <span class="va">x2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># chmura punktów</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">1.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># elipsa rozrzutu (1 odchylenie standardowe ~ poziom 0.68)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"norm"</span>, level <span class="op">=</span> <span class="fl">0.68</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># oryginalne osie układu współrzędnych (przez (0,0))</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">3</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">3</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># wektory składowych głównych (wychodzące ze środka danych)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">arrows_df</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># etykiety PC z udziałem wariancji</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">arrows_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>txt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">label</span><span class="op">==</span><span class="st">"PC1"</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC1 ("</span>, <span class="va">expl</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC2 ("</span>, <span class="va">expl</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xend</span>, y <span class="op">=</span> <span class="va">yend</span>, label <span class="op">=</span> <span class="va">txt</span><span class="op">)</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.05</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span>, hjust <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># punkt środka</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">center</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">center</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"x1 (oś oryginalna)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"x2 (oś oryginalna)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Oryginalne osie, dane oraz dwie składowe główne (2D)"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Udział wariancji: PC1 = "</span>, <span class="va">expl</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">", PC2 = "</span>, <span class="va">expl</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="pca_files/figure-html/unnamed-chunk-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="pca_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Dla dwóch wymiarów elipsa rozrzutu danych ma osie ustawione dokładnie wzdłuż <span class="math inline">\(w_{1}\)</span> i <span class="math inline">\(w_{2}\)</span>, a ich długości proporcjonalne do <span class="math inline">\(\sqrt{\lambda_{1}}\)</span> i <span class="math inline">\(\sqrt{\lambda_{2}}\)</span>. Transformacja do przestrzeni składowych odpowiada obrotowi układu współrzędnych tak, by oś <span class="math inline">\(X_{1}'\)</span> leżała w kierunku największego rozrzutu, a <span class="math inline">\(X_{2}'\)</span> — w kierunku pozostałej zmienności. Projekcja do <span class="math inline">\(k&lt;p\)</span> wymiarów działa jak rzut ortogonalny na podprzestrzeń rozpiętą przez pierwsze <span class="math inline">\(k\)</span> osi i „spłaszczenie” w pominiętych kierunkach, co minimalizuje błąd rekonstrukcji w sensie średniokwadratowym. Wykresy <em>scores</em> prezentują obiekty w przestrzeni składowych głównych i często ujawniają skupiska lub obserwacje odstające. Wektory <em>loadings</em> są przedstawiane na tzw. kole korelacji, gdzie końce strzałek leżą na okręgu jednostkowym, a ich długości i kąty odzwierciedlają korelacje zmiennych oryginalnych ze składowymi. Zmienne wskazujące podobne kierunki tworzą grupy, co pomaga rozumieć współzmienność. Wykres <em>biplot</em> łączy obie perspektywy: punkty obiektów i kierunki zmiennych w tej samej płaszczyźnie, dzięki czemu można podejrzeć jednocześnie relacje między obiektami i kontrybucje cech. Dodatkowo wykres udziału wariancji, czyli <em>scree plot</em>, porządkuje <span class="math inline">\(\lambda_{j}\)</span> i pomagać wyznaczyć <span class="math inline">\(k\)</span> przez identyfikację „łokcia” krzywej lub przez osiągnięcie założonego poziomu wariancji kumulatywnej.</p>
<p>Ładunek <span class="math inline">\(w_{jk}\)</span> to współczynnik liniowej kombinacji <span class="math inline">\(j\)</span>-tej składowej dla <span class="math inline">\(k\)</span>-tej zmiennej; jego znak i wartość bezwzględna informują o kierunku i sile związku. Korelację zmiennej z <span class="math inline">\(j\)</span>-tą składową szacujemy jako cosinus kąta między wektorem zmiennej a osią składowej na kole korelacji; duże wartości sugeruję dużą kontrybucję tej cechy do składowej. Rekonstrukcja obiektu <span class="math inline">\(i\)</span>-tego z <span class="math inline">\(k\)</span> składowych ma postać <span class="math inline">\(\hat{x}_{i}=\sum_{j=1}^{k} t_{ij} \, w_{j}^\top\)</span>, co pozwala na analizę błędów rekonstrukcji i odszumianie przez odcięcie składowych o małych <span class="math inline">\(d_{j}\)</span>. W regresji, gdy predyktory są współliniowe, stosuje się regresję na składowych głównych albo regresję grzbietową w przestrzeni <em>scores</em>, co poprawia stronę obliczeniową i zmniejszać wariancję estymatorów.</p>
</section><section id="kryteria-doboru-liczby-składowych-głównych" class="level3"><h3 class="anchored" data-anchor-id="kryteria-doboru-liczby-składowych-głównych">Kryteria doboru liczby składowych głównych</h3>
<p>Dobór liczby składowych głównych (<span class="math inline">\(k\)</span>) jest jednym z kluczowych etapów analizy PCA, ponieważ decyduje o tym, ile informacji (wariancji) zostanie zachowane przy redukcji wymiarowości. Zbyt mała liczba składowych prowadzi do utraty istotnych informacji, a zbyt duża – do utrzymania szumu i nadmiarowej redundancji. W praktyce stosuje się zestaw kryteriów ilościowych i jakościowych, które można podzielić na kilka grup.</p>
<section id="kryteria-oparte-na-wariancji-wyjaśnianej" class="level4"><h4 class="anchored" data-anchor-id="kryteria-oparte-na-wariancji-wyjaśnianej">Kryteria oparte na wariancji wyjaśnianej</h4>
<p>Najbardziej klasyczne podejście polega na analizie udziału wariancji przechwyconej przez pierwsze <span class="math inline">\(k\)</span> składowych. Dla każdej składowej liczy się wartość własną <span class="math inline">\(\lambda_j\)</span> macierzy kowariancji, a udział wariancji wyjaśnianej przez pierwsze <span class="math inline">\(k\)</span> składowych to <span class="math display">\[
\eta(k) = \frac{\sum_{j=1}^k \lambda_j}{\sum_{j=1}^p \lambda_j}.
\]</span> Stosowane reguły:</p>
<ul>
<li>Reguła progu wariancji - wybiera się najmniejsze <span class="math inline">\(k\)</span>, dla którego <span class="math inline">\(\eta(k)\)</span> przekracza ustalony próg, np. 80%, 90% lub 95% (w literaturze nie ma jednego progu). Gdy dane silnie skorelowane – wystarczą 2–3 składowe, a gdy dane są bardziej złożone – potrzeba więcej (5–10 i więcej).</li>
<li>Wykres osypiska (<em>scree plot</em>) – wykres wartości własnych <span class="math inline">\(\lambda_j\)</span> uporządkowanych malejąco. Wybiera się punkt, w którym tempo spadku gwałtownie maleje („łokieć krzywej”).</li>
<li>Wskaźnik udziału marginalnego - <span class="math inline">\(\Delta \eta_j = \eta(j) - \eta(j-1)\)</span>. Gdy przyrost staje się znikomy, dalsze składowe nie wnoszą istotnej informacji.</li>
</ul></section><section id="kryteria-algebraiczne" class="level4"><h4 class="anchored" data-anchor-id="kryteria-algebraiczne">Kryteria algebraiczne</h4>
<p>Kryterium wartości własnej (Kaisera–Guttmana) oparte jest na macierzy korelacji, które mówi, że zachowuje się tylko te składowe, których wartości własne <span class="math inline">\(\lambda_j &gt; 1\)</span>. Oznacza to, że dana składowa wyjaśnia więcej wariancji niż pojedyncza standaryzowana zmienna. Reguła ta jest prosta, ale często zbyt konserwatywna (tendencja do wyboru zbyt wielu składowych).</p>
</section><section id="kryteria-statystyczne-i-walidacyjne" class="level4"><h4 class="anchored" data-anchor-id="kryteria-statystyczne-i-walidacyjne">Kryteria statystyczne i walidacyjne</h4>
<ul>
<li>Analiza równoległa (<em>Parallel Analysis</em>) - polega na porównaniu wartości własnych uzyskanych z danych rzeczywistych z wartościami własnymi uzyskanymi z wielu symulowanych zestawów danych o tych samych wymiarach, ale z losowym szumem. Zachowuje się tylko te składowe, których wartości własne przekraczają średnią (lub kwantyl) z rozkładu symulowanego. Ta metoda ogranicza ryzyko wyboru składowych wynikających z przypadku.</li>
<li>Walidacja krzyżowa (<em>Cross-Validation</em>) - gdy PCA wykorzystuje się w kontekście modelowania predykcyjnego (np. <em>PCA regression</em>). Wybiera się takie <span class="math inline">\(k\)</span>, które minimalizuje błąd predykcji (np. RMSE) obliczany metodą walidacji krzyżowej.</li>
<li>
<em>Bartlett’s Test of Sphericity</em> sprawdza, czy korelacje są wystarczająco silne, by PCA miała sens.</li>
<li>
<em>Broken Stick Model</em> porównuje udział wariancji każdej składowej z oczekiwaną wartością przy losowym rozkładzie wariancji – zachowuje się tylko te składowe, które przekraczają tę wartość (<span class="math inline">\(E_k=\frac{1}{p}\sum_{j=k}^{p}\frac{1}{j}\)</span>).</li>
</ul></section><section id="kryteria-interpretacyjne-i-dziedzinowe" class="level4"><h4 class="anchored" data-anchor-id="kryteria-interpretacyjne-i-dziedzinowe">Kryteria interpretacyjne i dziedzinowe</h4>
<p>Czasami najważniejszy jest nie wynik numeryczny, lecz użyteczność interpretacyjna:</p>
<ul>
<li>Wybiera się tyle składowych, ile da się sensownie zinterpretować (np. odpowiadających znanym procesom fizycznym, ekonomicznym, biologicznym).</li>
<li>W analizie wizualnej (np. w eksploracji danych) często wybiera się 2 lub 3 pierwsze składowe, które umożliwiają wykresy 2D lub 3D.</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 29%">
</colgroup>
<thead><tr class="header">
<th>Kryterium</th>
<th>Opis</th>
<th>Zalety</th>
<th>Ograniczenia</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Udział wariancji (np. ≥90%)</strong></td>
<td>Zachowaj tyle składowych, by wyjaśnić określony procent całkowitej wariancji</td>
<td>Proste i intuicyjne</td>
<td>Wybór progu bywa arbitralny</td>
</tr>
<tr class="even">
<td><strong>Wykres osypiska (<em>scree plot</em>)</strong></td>
<td>Wybór punktu „kolana” na krzywej wartości własnych</td>
<td>Wizualnie czytelne</td>
<td>Subiektywne, zależy od interpretacji obserwatora</td>
</tr>
<tr class="odd">
<td><strong>Wartość własna &gt; 1 (Kaiser–Guttman)</strong></td>
<td>Zachowaj składowe, których wartości własne przekraczają 1 (dla macierzy korelacji)</td>
<td>Łatwe obliczeniowo</td>
<td>Często zbyt liberalne – wybiera zbyt wiele składowych</td>
</tr>
<tr class="even">
<td><strong>Analiza równoległa (<em>Parallel Analysis</em>)</strong></td>
<td>Porównanie wartości własnych z rozkładem uzyskanym z danych losowych</td>
<td>Statystycznie uzasadnione, ogranicza wybór przypadkowych komponentów</td>
<td>Wymaga symulacji lub dedykowanego oprogramowania</td>
</tr>
<tr class="odd">
<td><strong>Walidacja krzyżowa (<em>Cross-Validation</em>)</strong></td>
<td>Wybór liczby składowych minimalizującej błąd predykcji (np. RMSE)</td>
<td>Najlepsza w kontekście modeli predykcyjnych</td>
<td>Kosztowna obliczeniowo, wymaga podziału danych</td>
</tr>
<tr class="even">
<td><strong>Model <em>Broken Stick</em></strong></td>
<td>Porównanie udziału wariancji składowych z oczekiwanym rozkładem losowym</td>
<td>Uzasadnione teoretycznie, ogranicza przeuczenie</td>
<td>Mniej intuicyjne, rzadziej używane</td>
</tr>
<tr class="odd">
<td><strong>Kryterium interpretacyjne</strong></td>
<td>Wybór liczby składowych możliwych do sensownej interpretacji</td>
<td>Praktyczne i kontekstowe</td>
<td>Subiektywne i zależne od wiedzy dziedzinowej</td>
</tr>
</tbody>
</table>
<div id="exm-1" class="theorem example">
<p><span class="theorem-title"><strong>Przykład 5.1 (PCA na danych irysów)</strong></span> &nbsp;</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/factoextra">factoextra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/easystats/">easystats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com">gt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pca_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="op">-</span><span class="fl">5</span><span class="op">]</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co"># albo</span></span>
<span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu">principal_components</span><span class="op">(</span><span class="va">iris</span>, n <span class="op">=</span> <span class="fl">4</span>, rotate <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="co"># domyślnie standaryzuje zmienne</span></span>
<span></span>
<span><span class="co"># Wykres osypiska</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/eigenvalue.html">fviz_eig</a></span><span class="op">(</span><span class="va">pca_iris</span>, addlabels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="pca_files/figure-html/unnamed-chunk-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="pca_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Jak widać z powyższego wykresu osypiska pierwsza składowa wyjaśnia około 73% całkowitej wariancji, a druga 23%. Jeśli chcieć opierać wybór liczby składowych głównych na kryteriach (również takich, które nie były prezentowane powyżej), to można użyć funkcji <code>n_components()</code> pakietu <code>parameters</code> w ekosystemie <code>easystats</code>.</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu">n_components</span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="op">-</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   n_Factors              Method       Family
1          0          Scree (R2)     Scree_SE
2          1             Bentler      Bentler
3          1 Optimal coordinates        Scree
4          1 Acceleration factor        Scree
5          1   Parallel analysis        Scree
6          1    Kaiser criterion        Scree
7          1       Velicer's MAP Velicers_MAP
8          2          Scree (SE)     Scree_SE
9          2    VSS complexity 1          VSS
10         2    VSS complexity 2          VSS
11         3            Bartlett      Barlett
12         3            Anderson      Barlett
13         3              Lawley      Barlett</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="pca_files/figure-html/unnamed-chunk-3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="pca_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Choć większość kryteriów wskazuje na 1 składową, to na potrzeby przykładu wykorzystamy dwie składowe. Wyjaśniają one blisko 96% całkowitej wariancji (patrz poniżej). Możemy teraz przejrzeć wyniki PCA, czyli macierz ładunków (wektorów własnych) i macierz wyników projekcji (<em>scores</em>).</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Udział wariancji</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pca_iris</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1    PC2     PC3     PC4
Standard deviation     1.7084 0.9560 0.38309 0.14393
Proportion of Variance 0.7296 0.2285 0.03669 0.00518
Cumulative Proportion  0.7296 0.9581 0.99482 1.00000</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ładunki (wektory własne)</span></span>
<span><span class="va">pca_iris</span><span class="op">$</span><span class="va">rotation</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                    PC1         PC2        PC3        PC4
Sepal.Length  0.5210659 -0.37741762  0.7195664  0.2612863
Sepal.Width  -0.2693474 -0.92329566 -0.2443818 -0.1235096
Petal.Length  0.5804131 -0.02449161 -0.1421264 -0.8014492
Petal.Width   0.5648565 -0.06694199 -0.6342727  0.5235971</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># scores</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">pca_iris</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>           PC1        PC2         PC3          PC4
[1,] -2.257141 -0.4784238  0.12727962  0.024087508
[2,] -2.074013  0.6718827  0.23382552  0.102662845
[3,] -2.356335  0.3407664 -0.04405390  0.028282305
[4,] -2.291707  0.5953999 -0.09098530 -0.065735340
[5,] -2.381863 -0.6446757 -0.01568565 -0.035802870
[6,] -2.068701 -1.4842053 -0.02687825  0.006586116</code></pre>
</div>
</div>
<p>Pierwsza składowa główna (<code>PC1</code>) jest kombinacją liniową wszystkich czterech zmiennych, przy czym trzy z nich — <code>Sepal.Length</code>, <code>Petal.Length</code> oraz <code>Petal.Width</code> — mają dodatnie ładunki, natomiast <code>Sepal.Width</code> ma ładunek ujemny. Oznacza to, że składowa ta rośnie, gdy długość działki kielicha oraz długość i szerokość płatków są duże, a maleje, gdy szerokość działki jest duża. Można zatem interpretować <code>PC1</code> jako wymiar opisujący ogólny rozmiar kwiatu: kwiaty o większych płatkach i węższych działkach uzyskują wyższe wartości tej składowej. W zbiorze iris <code>PC1</code> bardzo dobrze rozdziela gatunki – <code>setosa</code> charakteryzuje się niskimi wartościami tej składowej (krótkie płatki, szerokie działki), natomiast <code>versicolor</code> i <code>virginica</code> mają wartości wysokie, co odpowiada większym rozmiarom kwiatów.</p>
<p>Druga składowa główna (<code>PC2</code>) ma zupełnie inną strukturę ładunków. Zdominowana jest przez bardzo silny ujemny współczynnik dla <code>Sepal.Width</code> oraz mniejszy, również ujemny, dla <code>Sepal.Length</code>. Wpływ płatków na tę składową jest niewielki. PC2 odzwierciedla zatem zmienność w obrębie kształtu działki kielicha, a zwłaszcza jej proporcji długości do szerokości. Kwiaty o węższych działkach mają wyższe wartości PC2, natomiast te o szerszych – niższe.</p>
<p>Interpretując wspólnie obie składowe, można stwierdzić, że <code>PC1</code> opisuje rozmiar kwiatu, natomiast <code>PC2</code> – proporcje i kształt działki. W przestrzeni <code>PC1–PC2</code> dane tworzą układ, w którym <code>setosa</code> jest wyraźnie oddzielona od pozostałych gatunków poprzez niskie wartości <code>PC1</code> i wysokie <code>PC2</code>, a <code>versicolor</code> i <code>virginica</code> różnią się między sobą głównie wzdłuż drugiej osi. W rezultacie te dwie składowe pozwalają na niemal pełne odwzorowanie i wizualne rozdzielenie gatunków, przy czym <code>PC1</code> odpowiada za wymiar wielkościowy, a <code>PC2</code> – za wymiar kształtowy. Na potrzeby wizualizacji możemy narysować wykres <em>biplot</em> łączący obiekty i zmienne w przestrzeni dwóch pierwszych składowych.</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html">fviz_pca_biplot</a></span><span class="op">(</span><span class="va">pca_iris</span>, repel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                col.var <span class="op">=</span> <span class="st">"blue"</span>, <span class="co"># kolor zmiennych</span></span>
<span>                col.ind <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span> <span class="op">+</span> <span class="co"># kolor obiektów wg gatunku</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="pca_files/figure-html/unnamed-chunk-5-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="pca_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section></section></section><section id="ica" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="ica">ICA</h2>
<p>Podstawowy model ICA (ang. <em>Independent Component Analysis</em>) zakłada, że wektor obserwacji <span class="math inline">\(X \in \mathbb{R}^p\)</span> powstaje poprzez liniowe i natychmiastowe wymieszanie wektora ukrytych źródeł <span class="math inline">\(s \in \mathbb{R}^m\)</span> o statystycznie niezależnych składowych <span class="math display">\[
X = A s,\qquad A \in \mathbb{R}^{p\times m},
\]</span> przy czym <span class="math inline">\(m \le \min(p,n)\)</span> oraz macierz mieszająca <span class="math inline">\(A\)</span> ma pełny rząd. Celem jest oszacowanie macierzy demiksującej <span class="math inline">\(W \in \mathbb{R}^{m\times p}\)</span> tak, aby <span class="math inline">\(y = W X\)</span> aproksymować <span class="math inline">\(s\)</span> składowymi możliwie niezależnymi w sensie probabilistycznym. Z istoty problemu rozwiązanie identyfikowalne jest jedynie do permutacji i skalowania - kolejność oraz skale (a więc i znaki) składowych nie są odzyskiwalne.</p>
<p>Wyprowadzenie algorytmów ICA rozpoczynamy od scentralizowania danych i ich <em>whiteningu.</em> Niech <span class="math inline">\(\Sigma_X = \tfrac{1}{n}\sum_i (X_i-\bar X)(X_i-\bar X)^\top\)</span> oraz niech <span class="math inline">\(V\)</span> oznacza macierz <em>whitening</em> taką, że <span class="math inline">\(Z=V(X-\bar X)\)</span> spełnia <span class="math inline">\(\operatorname{Cov}(Z)=I_p\)</span>. W praktyce przyjmujemy <span class="math inline">\(V=\Lambda^{-1/2}U^\top\)</span> z dekompozycji <span class="math inline">\(\Sigma_X=U\Lambda U^\top\)</span>. W przestrzeni <em>whitened</em> model przyjmuje postać <span class="math display">\[
Z = V A s \equiv R\, s,
\]</span> gdzie <span class="math inline">\(R\)</span> jest macierzą ortogonalną (dla przypadku <span class="math inline">\(m=p\)</span>). Poszukujemy więc wektorów w jednostkowej normie, dla których skalarna projekcja <span class="math inline">\(y=w^\top Z\)</span> jest możliwie „nienormalna” (niesymetryczna lub ciężkoogonowa), co stanowi praktyczne kryterium niezależności.</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Pakiety</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">fastICA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">44</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1) Generowanie dwóch niezależnych źródeł (niegaussowskich)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">3000</span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="va">n</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>  <span class="co"># Jednostronnie cięższy ogon (Eksponencjalny przesunięty do zera średniej)</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>        <span class="co"># Równomierny (płaskie ogony)</span></span>
<span><span class="va">S</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">s2</span><span class="op">)</span></span>
<span><span class="va">S</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">S</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># zero-mean dla wygody</span></span>
<span></span>
<span><span class="co"># 2) Mieszanie źródeł macierzą A -&gt; obserwacje X</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>,</span>
<span>              <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>                        <span class="co"># model X = S A^T</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># centrowanie (odjęcie średniej kolumn)</span></span>
<span></span>
<span><span class="co"># 3) Whitening (sferyzacja): Z = V X, gdzie V = Λ^{-1/2} U^T z dekompozycji Σ_X</span></span>
<span><span class="va">SigmaX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">SigmaX</span><span class="op">)</span></span>
<span><span class="va">U</span> <span class="op">&lt;-</span> <span class="va">e</span><span class="op">$</span><span class="va">vectors</span></span>
<span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">e</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">Lambda</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span>     <span class="co"># Λ^{-1/2} U^T</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">V</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>                    <span class="co"># Z = V X (w wierszach obserwacje)</span></span>
<span></span>
<span><span class="co"># Kontrola: kowariancja Z ~ I</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    0
[2,]    0    1</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 4) ICA (FastICA) na danych whitened (można też na X bo fastICA automatycznie wykonuje whitening)</span></span>
<span><span class="va">ica</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fastICA/man/fastICA.html">fastICA</a></span><span class="op">(</span><span class="va">Z</span>, n.comp <span class="op">=</span> <span class="fl">2</span>, method <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span>  <span class="co"># odzyskane źródła Y i mieszanie A_ICA</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">ica</span><span class="op">$</span><span class="va">S</span>                                   <span class="co"># szacowane źródła niezależne (kolumny ~ komponenty)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="va">ica</span><span class="op">$</span><span class="va">K</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">ica</span><span class="op">$</span><span class="va">W</span>                         <span class="co"># łączne "demiksowanie" względem X (tu pracowaliśmy na Z)</span></span>
<span><span class="co"># Uwaga: fastICA zwraca też K (whitening) i W (unmixing), składnia zależy od wejścia</span></span>
<span></span>
<span><span class="co"># 5) Przygotowanie danych do wykresów</span></span>
<span><span class="va">to_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">M</span>, <span class="va">name</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c1"</span>,<span class="st">"c2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="va">name</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">df_X</span> <span class="op">&lt;-</span> <span class="fu">to_df</span><span class="op">(</span><span class="va">X</span>, <span class="st">"X: dane zmieszane"</span><span class="op">)</span></span>
<span><span class="va">df_Z</span> <span class="op">&lt;-</span> <span class="fu">to_df</span><span class="op">(</span><span class="va">Z</span>, <span class="st">"Z: po whitening"</span><span class="op">)</span></span>
<span><span class="va">df_Y</span> <span class="op">&lt;-</span> <span class="fu">to_df</span><span class="op">(</span><span class="va">Y</span>, <span class="st">"Y: po ICA (źródła)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">df_X</span>, <span class="va">df_Z</span>, <span class="va">df_Y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6) Oś układu i wektory bazowe (do wizualizacji obrotów)</span></span>
<span><span class="co">#    W przestrzeni Z osie są już sferyczne (I), więc ICA to „tylko” obrót.</span></span>
<span><span class="va">axes_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">scale_len</span> <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>             xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">scale_len</span>,<span class="fl">0</span><span class="op">)</span>, yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">scale_len</span><span class="op">)</span>,</span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"e1"</span>,<span class="st">"e2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">axesZ</span> <span class="op">&lt;-</span> <span class="fu">axes_df</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 7) Wykresy: chmury punktów w 2D (X, Z, Y)</span></span>
<span><span class="va">pX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_X</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">c1</span>, <span class="va">c2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.25</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Przed whiteningiem (X)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"X[,1]"</span>, y <span class="op">=</span> <span class="st">"X[,2]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_Z</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">c1</span>, <span class="va">c2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.25</span>, size <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"#2E86DE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">axesZ</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.18</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">axesZ</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xend</span>, y <span class="op">=</span> <span class="va">yend</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>,</span>
<span>            nudge_x <span class="op">=</span> <span class="fl">0.05</span>, nudge_y <span class="op">=</span> <span class="fl">0.05</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Po whitening (Z): Cov ≈ I"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Z[,1]"</span>, y <span class="op">=</span> <span class="st">"Z[,2]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_Y</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">c1</span>, <span class="va">c2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.25</span>, size <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"#16A085"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Po ICA (Y): odzyskane źródła niezależne"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Y[,1]"</span>, y <span class="op">=</span> <span class="st">"Y[,2]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">pX</span> <span class="op">|</span> <span class="va">pZ</span> <span class="op">|</span> <span class="va">pY</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="pca_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="pca_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="1440"></a></p>
</figure>
</div>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 8) Dodatkowo: marginesowe histogramy pokazujące „nienormalność”</span></span>
<span><span class="va">hX</span> <span class="op">&lt;-</span> <span class="va">df_X</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c1"</span>,<span class="st">"c2"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"col"</span>, values_to <span class="op">=</span> <span class="st">"val"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c1"</span>,<span class="st">"c2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="st">"X"</span><span class="op">)</span></span>
<span><span class="va">hZ</span> <span class="op">&lt;-</span> <span class="va">df_Z</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c1"</span>,<span class="st">"c2"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"col"</span>, values_to <span class="op">=</span> <span class="st">"val"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c1"</span>,<span class="st">"c2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="st">"Z"</span><span class="op">)</span></span>
<span><span class="va">hY</span> <span class="op">&lt;-</span> <span class="va">df_Y</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c1"</span>,<span class="st">"c2"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"col"</span>, values_to <span class="op">=</span> <span class="st">"val"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c1"</span>,<span class="st">"c2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">h_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">hX</span>,<span class="va">hZ</span>,<span class="va">hY</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">stage</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>,<span class="st">"Z"</span>,<span class="st">"Y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">h_all</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">60</span>, fill <span class="op">=</span> <span class="st">"grey70"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">stage</span> <span class="op">~</span> <span class="va">col</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Marginalne rozkłady: przed whiteningiem, po whitening, po ICA"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"wartość"</span>, y <span class="op">=</span> <span class="st">"liczność"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="pca_files/figure-html/unnamed-chunk-6-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="pca_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="1440"></a></p>
</figure>
</div>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 9) Krótka kontrola: kowariancje i korelacje</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nKowariancja X:\n"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Kowariancja X:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]
[1,] 6.295 4.620
[2,] 4.620 5.123</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nKowariancja Z (powinna być bliska I):\n"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Kowariancja Z (powinna być bliska I):</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    0
[2,]    0    1</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nKorelacje pomiędzy kolumnami Y (powinny być bliskie 0; niezależność jest mocniejsza niż brak korelacji):\n"</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Korelacje pomiędzy kolumnami Y (powinny być bliskie 0; niezależność jest mocniejsza niż brak korelacji):</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    0
[2,]    0    1</code></pre>
</div>
</div>
<p>Podejście maksymalizujące nienormalność opiera się na kurtozie lub na przybliżonej negatywnej entropii (ang. <em>negentropy</em>). Dla <span class="math inline">\(\operatorname{Var}(y)=1\)</span> kurtoza <span class="math inline">\(\kappa(y)=\mathbb{E}\{y^4\}-3\)</span> przyjmuje wartości 0 dla rozkładu normalnego i wartości odległe od zera dla rozkładów nienormalnych. Maksymalizacja <span class="math inline">\(|\kappa(w^\top Z)|\)</span> prowadzi do składowych niezależnych. Stabilniejsze i bardziej ogólne kryterium stanowi <em>negentropy</em> <span class="math inline">\(J(y)=H(y_{\text{gauss}})-H(y)\)</span>, gdzie <span class="math inline">\(H\)</span> oznacza entropię. W praktyce stosuje się aproksymacje postaci <span class="math display">\[
J(y)\approx \Big(\mathbb{E}\,G(y)-\mathbb{E}\,G(v)\Big)^2,
\]</span> z dobraną nieliniowością <span class="math inline">\(G\)</span> oraz <span class="math inline">\(v\sim \mathcal N(0,1)\)</span>. Maksymalizacja <span class="math inline">\(J\)</span> przy ograniczeniu <span class="math inline">\(\|w\|=1\)</span> zapewnia poszukiwanie najbardziej nienormalnych kierunków.</p>
<p>Z kryteriów tych wynika algorytm <em>FastICA</em> jako iteracja stałego punktu. Dla jednego komponentu w przestrzeni <em>whitened</em> stosujemy aktualizację <span class="math display">\[
w \leftarrow \mathbb{E}\{Z\,g(w^\top Z)\}-\mathbb{E}\{g’(w^\top Z)\}\, w,\qquad \text{następnie } w\leftarrow \frac{w}{\|w\|},
\]</span> gdzie <span class="math inline">\(g=G’\)</span> jest <em>score function</em> (np. <span class="math inline">\(g(u)=\tanh(u)\)</span>, <span class="math inline">\(g(u)=u^3\)</span> lub <span class="math inline">\(g(u)=u\exp(-u^2/2)\)</span>). Dla wielu składowych stosujemy równoległe aktualizacje i ortogonalizację w kolejnych krokach, np. metodą rzutów Grama–Schmidta lub przez dekompozycję symetryczną <span class="math inline">\(W\leftarrow (WW^\top)^{-1/2}W\)</span>, co zachowuje wzajemną ortogonalność wektorów w przestrzeni <em>whitened</em> i zapobiega zbieżności do tej samej składowej.</p>
<p>Alternatywne wyprowadzenie pochodzi z maksymalizacji funkcji wiarygodności (<em>maximum likelihood</em>). Zakładając niezależność źródeł z gęstościami <span class="math inline">\(p_{s_i}\)</span> i (dla prostoty) brak szumu, otrzymujemy logarytm funkcji wiarygodności <span class="math display">\[
\mathcal L(W)=\sum_{t=1}^n\Bigg(\sum_{i=1}^m \log p_{s_i}\big((W X_t)_i\big)\Bigg) + n\log|\det W|.
\]</span> Jej gradient prowadzi do zasady <em>Infomax</em>, która brzmi: dobrać <span class="math inline">\(W\)</span> tak, aby wyjścia miały jak największą sumę entropii (co przy zachowaniu <span class="math inline">\(\log|\det W|\)</span> jest równoważne maksymalizacji wspólnej niezależności). W praktyce wybór rodziny <span class="math inline">\(p_{s_i}\)</span> implikuje odpowiednie nieliniowości w regule uczenia, formalnie zbieżne z powyższymi kontrastami na <em>negentropy.</em></p>
<p>W obecności szumu addytywnego <span class="math inline">\(X = A s + \varepsilon\)</span> z <span class="math inline">\(\varepsilon\sim \mathcal N(0,\sigma^2 I)\)</span> problem staje się trudniejszy. Stosuje się wówczas rozszerzone modele ICA z estymacją rzędu i składowej szumowej, warianty bayesowskie, lub metody wykorzystujące dodatkowe własności źródeł (np. niezależność czasową wyższych rzędów, jak w SOBI wykorzystującym autokowariancje).</p>
<p>Założenia identyfikowalności obejmują liniowość i natychmiastowość mieszania, niezależność składowych źródłowych, co najwyżej jedną składową o rozkładzie normalnym (inaczej problem staje się nierozwiązywalny z powodu nieodróżnialności kierunków gaussowskich), pełny rząd macierzy <span class="math inline">\(A\)</span> oraz wystarczającą nienormalność źródeł, aby kontrasty informacyjne miały sens. Zwyczajowo zakłada się również stacjonarność w czasie, o ile wykorzystujemy momenty lub autokorelacje do estymacji.</p>
<p>Dobór liczby składowych w ICA nie opiera się na udziale wariancji, jak w PCA, ponieważ ICA nie porządkuje komponentów według wariancji. W praktyce najpierw wybiera się wymiar <em>whiteningu</em> <span class="math inline">\(m\)</span> (efektywny rząd sygnału), a następnie ekstrahuje <span class="math inline">\(m\)</span> składowych niezależnych. Kryteria wyboru <span class="math inline">\(m\)</span> obejmują informacyjne miary rzędu macierzy kowariancji, takie jak MDL/BIC dopasowane do modelu składowej szumowej i niezerowych wartości własnych, testy istotności dla wartości własnych po <em>whiteningu</em> (warianty analizy równoległej, permutacyjne testy mierzące losowość), walidację na podstawie wiarygodności w modelu ML-ICA z różnymi <span class="math inline">\(m\)</span> oraz kryteria stabilności. Kryteria stabilności polegają na wielokrotnym uruchomieniu algorytmu z różnymi inicjalizacjami i grupowaniu uzyskanych komponentów. Liczba dobrze replikujących się grup daje oszacowanie na <span class="math inline">\(m\)</span>. Dodatkowo stosuje się testy resztowej zależności między oszacowanymi źródłami (np. testy niezależności na bazie informacji wzajemnej). Jeśli po dodaniu kolejnej składowej informacja wzajemna między „źródłami” nie maleje, zwiększanie <span class="math inline">\(m\)</span> nie przynosi korzyści. W zastosowaniach z szumem wybieramy <span class="math inline">\(m\)</span> tak, by oddzielać podprzestrzeń sygnałową od szumowej, co praktycznie sprowadza się do analizy spektrum wartości własnych i modelowania ogona jako białego szumu.</p>
<p>Interpretacja wyników ICA różnić się od PCA. Składowe ICA <span class="math inline">\(y_i\)</span> stanowią oceny źródeł o maksymalnej niezależności, a wiersze <span class="math inline">\(W\)</span> definiują filtry demiksujące, podczas gdy kolumny <span class="math inline">\(A\)</span> (przyjmując <span class="math inline">\(A\approx W^{-1}\)</span>) reprezentują wzorce mieszania, czyli „mapy obciążenia” źródeł na czujniki/cechy. Skale i znaki składowych są arbitralne, co wymaga interpretować je względnie: znormalizować wariancję lub maksymalną wartość, a znak dobrać tak, by ułatwić opis dziedzinowy<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. W przeciwieństwie do PCA, składowe ICA nie muszą być ortogonalne, a ich wariancje nie są uporządkowane<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;Wyobraźmy sobie, że ICA rozdziela dwa źródła dźwięku — skrzypce i fortepian. Jeśli algorytm zwróci sygnał, który jest odwrócony w fazie (czyli pomnożony przez -1), to dźwięk fortepianu jest ten sam fizycznie, tylko wszystkie amplitudy mają odwrotny znak. Dlatego znak (i skala) nie mają znaczenia dla jakości separacji — są arbitralne.</p></div><div id="fn6"><p><sup>6</sup>&nbsp;W sygnałach biologicznych, takich jak EEG, ICA może oddzielić artefakty ruchowe od sygnałów mózgowych. Artefakty te mogą być silnie nienormalne i niezależne od sygnałów mózgowych, co czyni ICA skuteczną metodą ich identyfikacji i usunięcia.</p></div></div><div id="exm-2" class="theorem example">
<p><span class="theorem-title"><strong>Przykład 5.2 (ICA na mieszance sygnałów)</strong></span> &nbsp;</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"EuStockMarkets"</span><span class="op">)</span></span>
<span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">)</span>              <span class="co"># poziomy indeksów: DAX, SMI, CAC, FTSE</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">P</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># dzienne log-zwroty</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ICA na dziennych zwrotach</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">ica_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fastICA/man/fastICA.html">fastICA</a></span><span class="op">(</span><span class="va">R</span>, n.comp <span class="op">=</span> <span class="fl">4</span>, method <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="va">S_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">ica_res</span><span class="op">$</span><span class="va">S</span><span class="op">)</span>               <span class="co"># odzyskane źród</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">S_est</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"IC"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">A_est</span> <span class="op">&lt;-</span> <span class="va">ica_res</span><span class="op">$</span><span class="va">A</span>                              <span class="co"># macierz mieszająca</span></span>
<span><span class="va">W_est</span> <span class="op">&lt;-</span> <span class="va">ica_res</span><span class="op">$</span><span class="va">K</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">ica_res</span><span class="op">$</span><span class="va">W</span>                <span class="co"># macierz demiksująca</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Macierz <code>A_est</code>, czyli macierz mieszania, opisuje sposób, w jaki oryginalne zmienne obserwowalne — w tym przypadku cztery indeksy giełdowe: DAX, SMI, CAC i FTSE — powstają jako liniowe kombinacje ukrytych, niezależnych czynników. Każdy wiersz tej macierzy odpowiada jednemu indeksowi, a każda kolumna jednej składowej niezależnej. Wartości liczbowe oznaczają współczynniki liniowych kombinacji, czyli wpływ danej składowej na dany indeks. Wartość dodatnia wskazuje, że wzrost komponentu powoduje wzrost indeksu, wartość ujemna — że ruch komponentu przekłada się na spadek indeksu, a wartość bliska zeru oznacza brak istotnego związku.</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">A_est</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>       [,1]   [,2]   [,3]   [,4]
[1,] -0.001 -0.001 -0.002 -0.006
[2,]  0.003 -0.004  0.002  0.000
[3,] -0.010 -0.008 -0.008 -0.005
[4,]  0.000  0.001  0.008  0.001</code></pre>
</div>
</div>
<ul>
<li>Pierwszy komponent (<code>IC1</code>) najsilniej ładuje się na indeks CAC, a w mniejszym stopniu na SMI. Znak ujemny dla CAC i dodatni dla SMI sugeruje, że komponent ten uchwyca różnicę pomiędzy rynkami strefy euro a rynkiem szwajcarskim, czyli czynnik kontrastujący. W praktyce oznacza to, że wzrost aktywności na rynkach kontynentalnych wiązać się może z relatywnym osłabieniem rynku SMI lub odwrotnie.</li>
<li>Drugi komponent (<code>IC2</code>) również oddziałuje na CAC i SMI w kierunku ujemnym, co może świadczyć o uchwyceniu wspólnego czynnika kontynentalnego o mniejszej amplitudzie. Dodatnie, choć niewielkie wartości dla FTSE wskazują, że komponent ten częściowo kontrastuje rynki kontynentalne z brytyjskim.</li>
<li>Trzeci komponent (<code>IC3</code>) ma wyraźnie odmienną strukturę. Dla FTSE współczynnik jest dodatni i największy, natomiast dla pozostałych indeksów ujemny. Komponent ten rozdziela zatem rynek brytyjski od reszty Europy i można go interpretować jako czynnik geograficzny lub walutowy, związany z odmiennym otoczeniem gospodarczym Wielkiej Brytanii.</li>
<li>Czwarty komponent (<code>IC4</code>) ma współczynniki bardzo małe, rzędu 10<sup>-3</sup>–10<sup>-2</sup>, co sugeruje, że jego wpływ na strukturę indeksów jest marginalny. Prawdopodobnie odpowiada on za szum lub krótkotrwałe, lokalne fluktuacje, które nie mają znaczenia ekonomicznego.</li>
</ul>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">W_est</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>         [,1]     [,2]    [,3]    [,4]
[1,]   43.737  112.245 -74.794 -85.258
[2,]   34.702 -146.908 -47.294  -7.649
[3,]   15.975   14.330   8.569 141.650
[4,] -173.263   -5.797  10.661 -35.834</code></pre>
</div>
</div>
<p>Macierz <code>W_est</code>, czyli macierz demiksująca, zawiera współczynniki liniowych kombinacji oryginalnych zmiennych (indeksów giełdowych), które pozwalają uzyskać poszczególne niezależne komponenty. Każdy wiersz tej macierzy odpowiada jednemu komponentowi ICA (IC1–IC4), a każda kolumna — jednej zmiennej obserwowalnej (DAX, SMI, CAC, FTSE). Wartości w tej macierzy można zatem interpretować jako wagi, z jakimi poszczególne indeksy uczestniczą w tworzeniu danego odzyskanego źródła.</p>
<ul>
<li>Pierwszy komponent (<code>IC1</code>) ma duże dodatnie wagi dla indeksów DAX i SMI oraz silnie ujemną wagę dla FTSE. Oznacza to, że <code>IC1</code> odzwierciedla kontrast pomiędzy rynkami kontynentalnymi (Niemcy, Szwajcaria) a rynkiem brytyjskim. Wzrost wartości <code>IC1</code> odpowiada sytuacji, w której indeksy kontynentalne zachowują się silniej niż FTSE — można więc interpretować ten czynnik jako różnicowy, typu „Europa kontynentalna kontra Wielka Brytania”.</li>
<li>Drugi komponent (<code>IC2</code>) pokazuje odwrotny schemat: dodatni wpływ DAX, silnie ujemny SMI, a słaby wpływ pozostałych indeksów. Można go interpretować jako czynnik rozróżniający zachowanie rynku niemieckiego i szwajcarskiego, który w ICA często ujawnia się jako efekt odmiennych warunków walutowych i struktury gospodarczej.</li>
<li>Trzeci komponent (<code>IC3</code>) ma wszystkie wagi ujemne, z wyjątkiem niewielkich dodatnich dla CAC i FTSE. Oznacza to, że <code>IC3</code> reprezentuje wspólny kierunek zmian większości indeksów (ruch globalny), ale w konstrukcji demiksującej występuje ze znakiem ujemnym. W praktyce odpowiada to czynnikowi rynkowemu o charakterze ogólnym — globalnemu impulsowi, który oddziałuje w podobny sposób na większość rynków.</li>
<li>Czwarty komponent (<code>IC4</code>) ma wysoką dodatnią wagę dla CAC oraz ujemne dla pozostałych indeksów, co sugeruje, że może on odzwierciedlać czynnik specyficzny dla rynku francuskiego — reakcje lokalne lub sektorowe, które nie są wspólne dla innych giełd..</li>
</ul>
<p>Znaki współczynników w ICA są arbitralne (zmiana wszystkich znaków w jednym wierszu nie zmienia modelu), dlatego przy interpretacji należy zwracać uwagę na względne zależności między indeksami, a nie na samą polaryzację znaków. Wartości bezwzględne wag pokazują natomiast, które indeksy mają największy udział w kształtowaniu danego czynnika.</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kurt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">S_est</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">4</span><span class="op">)</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span>  <span class="co"># kurtozy odzyskanych źródeł</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">kurt</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>                           <span class="co"># kurtozy (nienormalność)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  IC1   IC2   IC3   IC4 
5.601 1.985 8.206 2.274 </code></pre>
</div>
</div>
<p>Wartości kurtozy stanowią miarę niegaussowskości rozkładu — czyli tego, jak bardzo dany sygnał odbiega od kształtu rozkładu normalnego. Wartości dodatnie oznaczają rozkłady o „cięższych ogonach” i bardziej spiczastym kształcie (tzw. leptokurtyczne), co jest typowe dla sygnałów rzadkich, zawierających wyraźne piki i okresy stabilności. W kontekście ICA wysoka kurtoza jest pożądana, ponieważ algorytm poszukuje właśnie takich komponentów — maksymalnie odmiennych od normalnych, a więc potencjalnie niezależnych źródeł.</p>
<ul>
<li>
<code>IC1</code> (5.601) ma bardzo wysoką kurtozę, co wskazuje na silną niegaussowskość. Komponent ten prawdopodobnie reprezentuje główny, „rzadki” czynnik ekonomiczny, który reaguje gwałtownie w momentach istotnych zmian rynkowych. Może to być globalny impuls rynkowy lub okresowe szoki finansowe.</li>
<li>
<code>IC2</code> (1.985) ma umiarkowanie dodatnią kurtozę, sugerującą rozkład jedynie lekko leptokurtyczny. Oznacza to, że komponent jest bliższy rozkładowi normalnemu, a zatem mniej „niezależny” w sensie ICA. Może reprezentować łagodniejszy czynnik wspólny, np. codzienną zmienność lub trend regionalny.</li>
<li>
<code>IC3</code> (8.206) ma najwyższą kurtozę spośród wszystkich komponentów. Jest to bardzo silny sygnał niegaussowski, typowy dla źródła zawierającego rzadkie, intensywne zdarzenia — w kontekście finansowym mogą to być momenty skokowych zmian cen lub kryzysów, wpływające selektywnie na część indeksów. Ten komponent można traktować jako najbardziej „czyste” źródło w sensie ICA.</li>
<li>
<code>IC4</code> (2.274) wykazuje umiarkowaną kurtozę, zbliżoną do IC2. Można go interpretować jako dodatkowy, mniej wyraźny czynnik poboczny, który w pewnym stopniu odbiega od normalności, ale nie ma charakteru dominującego.</li>
</ul>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sprawdzenie korelacji między oryginalnymi a odzyskanymi sygnałami</span></span>
<span><span class="va">cor_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">R</span>, <span class="va">S_est</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">cor_matrix</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>        IC1    IC2    IC3   IC4
DAX  -0.076  0.287 -0.954 0.037
SMI  -0.060 -0.475 -0.871 0.108
CAC  -0.189  0.140 -0.686 0.689
FTSE -0.788  0.001 -0.602 0.125</code></pre>
</div>
</div>
<p>Macierz korelacji między oryginalnymi indeksami giełdowymi a odzyskanymi komponentami niezależnymi (<code>cor_matrix</code>) pokazuje, jak silnie i w jakim kierunku (znak dodatni lub ujemny) każdy z indeksów jest powiązany z danym źródłem ICA. Wysokie wartości bezwzględne wskazują, że dany komponent w dużym stopniu tłumaczy zmienność danego indeksu, natomiast wartości bliskie zera oznaczają słaby związek.</p>
<ul>
<li>Najsilniejsze korelacje obserwuje się dla komponentu <code>IC3</code>, który ma wartości ujemne i bardzo wysokie w module: DAX (−0.954), SMI (−0.871) i CAC (−0.686). Oznacza to, że <code>IC3</code> stanowi wspólny czynnik dominujący dla trzech kontynentalnych indeksów europejskich. Wszystkie trzy reagują w tym samym kierunku (ujemny znak jest konwencjonalny, jego odwrócenie nie zmienia interpretacji). Można zatem uznać, że <code>IC3</code> reprezentuje globalny czynnik rynkowy, wspólny dla głównych giełd kontynentalnych, a jego wysoka kurtoza (8.206) wskazuje, że czynnik ten cechuje się silnymi, epizodycznymi wahaniami — typowymi dla okresów zawirowań finansowych.</li>
<li>Komponent <code>IC1</code> wykazuje wyraźną ujemną korelację z FTSE (−0.788), przy braku silnych zależności z pozostałymi indeksami. Oznacza to, że <code>IC1</code> można interpretować jako czynnik specyficzny dla rynku brytyjskiego, niezależny od ruchów kontynentalnych. Wysoka wartość bezwzględna korelacji sugeruje, że ten komponent odpowiada za znaczną część zmienności FTSE, co dobrze współgra z interpretacją wcześniejszej macierzy mieszania — <code>IC1</code> oddzielał Wielką Brytanię od reszty Europy.</li>
<li>Komponent <code>IC2</code> wykazuje umiarkowane korelacje o różnych znakach: dodatnią z DAX (0.287) i ujemną ze SMI (−0.475). Można go zatem interpretować jako czynnik różnicowy pomiędzy rynkami Niemiec i Szwajcarii. W praktyce może on odzwierciedla odmienną reakcję tych rynków na czynniki lokalne, np. różnice w strukturze sektorowej lub polityce monetarnej.</li>
<li>Komponent <code>IC4</code> ma umiarkowaną dodatnią korelację z CAC (0.689), a pozostałe indeksy reagują na niego słabo. Oznacza to, że IC4 może być czynnikiem częściowo specyficznym dla rynku francuskiego, prawdopodobnie o charakterze lokalnym lub szumowym.</li>
</ul>
<p>Na koniec wizualizacja ICA.</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># odzyskane komponenty </span></span>
<span><span class="va">S_est_long</span> <span class="op">&lt;-</span> <span class="va">S_est</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">S_est</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"IC"</span><span class="op">)</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"Component"</span>, values_to <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">S_est_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Value</span>, color <span class="op">=</span> <span class="va">Component</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Component</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Odzyskane niezależne komponenty (ICA)"</span>, x <span class="op">=</span> <span class="st">"Czas"</span>, y <span class="op">=</span> <span class="st">"Wartość"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">R_long</span> <span class="op">&lt;-</span> <span class="va">R</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">Time</span>,    </span>
<span>                      names_to <span class="op">=</span> <span class="st">"Index"</span>, values_to <span class="op">=</span> <span class="st">"Return"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">R_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Return</span>, color <span class="op">=</span> <span class="va">Index</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Index</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Oryginalne dzienne log-zwroty indeksów"</span>, x <span class="op">=</span> <span class="st">"Czas"</span>, y <span class="op">=</span> <span class="st">"Log-zwrot"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_flat_d</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="pca_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="pca_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="1152"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section><section id="mds" class="level2"><h2 class="anchored" data-anchor-id="mds">MDS</h2>
<p>Metoda <em>Multidimensional Scaling</em> (MDS), czyli skalowanie wielowymiarowe, stanowi rodzinę technik służących do odwzorowania danych opisanych za pomocą macierzy odległości (lub podobieństw) w przestrzeń o niskim wymiarze — najczęściej dwuwymiarową lub trójwymiarową — w taki sposób, aby relacje między obiektami zostały zachowane możliwie wiernie. Celem jest więc konstrukcja wektorowej reprezentacji obiektów, która odtwarza zadane odległości.</p>
<p>Istnieją dwie podstawowe wersje MDS: metryczna i niemetryczna, różniące się sposobem odwzorowania wartości wejściowych i kryterium dopasowania.</p>
<section id="wersja-metryczna-klasyczna-mds" class="level3"><h3 class="anchored" data-anchor-id="wersja-metryczna-klasyczna-mds">Wersja metryczna (klasyczna MDS)</h3>
<section id="założenia" class="level4"><h4 class="anchored" data-anchor-id="założenia">Założenia</h4>
<p>Dane wejściowe stanowi ma macierz odległości euklidesowych <span class="math display">\[
\Delta = [\delta_{ij}]{n\times n}, \quad \delta{ij} \ge 0, \quad \delta_{ii}=0, \quad \delta_{ij}=\delta_{ji}.
\]</span> Celem jest znalezienie konfiguracji punktów <span class="math inline">\(X \in \mathbb{R}^{n\times p}\)</span>, takiej że odległości między punktami <span class="math inline">\(d_{ij}(X) = \|x_i - x_j\|\)</span> są jak najbardziej zbliżone do odległości zadanych <span class="math inline">\(\delta_{ij}.\)</span></p>
</section><section id="wyprowadzenie-modelu" class="level4"><h4 class="anchored" data-anchor-id="wyprowadzenie-modelu">Wyprowadzenie modelu</h4>
<p>Z klasycznej geometrii euklidesowej wynika, że iloczyn skalarny między wektorami można zapisać przez odległości <span class="math display">\[
x_i^\top x_j = \frac{1}{2}\bigl(\|x_i\|^2 + \|x_j\|^2 - \|x_i - x_j\|^2 \bigr).
\]</span> Jeżeli dane są wyrażone przez odległości <span class="math inline">\(\delta_{ij}\)</span>, to można odtworzyć tzw. macierz iloczynów skalarnych <span class="math inline">\(B = XX^\top\)</span>, która określa współrzędne punktów po odpowiednim scentralizowaniu układu współrzędnych. Operacja ta nazywa się podwójnym centrowaniem (<em>double centering</em>) <span class="math display">\[
B = -\frac{1}{2} J \Delta^{(2)} J,
\]</span> gdzie <span class="math inline">\(\Delta^{(2)} = [\delta_{ij}^2]\)</span> to macierz kwadratów odległości, a <span class="math inline">\(J = I_n - \frac{1}{n}\mathbf{1}\mathbf{1}^\top\)</span> to macierz centrowania (usuwa środek ciężkości układu).</p>
<p>Macierz <span class="math inline">\(B\)</span> powinna być dodatnio półokreślona (w przypadku euklidesowym). Następnie wykonuje się jej rozkład spektralny <span class="math display">\[
B = V \Lambda V^\top,
\]</span> gdzie <span class="math inline">\(\Lambda = \operatorname{diag}(\lambda_1, \ldots, \lambda_n)\)</span> zawiera wartości własne uporządkowane malejąco, a <span class="math inline">\(V\)</span> to odpowiadające im wektory własne. Współrzędne punktów w przestrzeni o wymiarze <span class="math inline">\(p\)</span> wyznacza się przez <span class="math display">\[
X_p = V_p \Lambda_p^{1/2},
\]</span> gdzie <span class="math inline">\(V_p\)</span> zawiera <span class="math inline">\(p\)</span> pierwszych wektorów własnych, a <span class="math inline">\(\Lambda_p\)</span> odpowiadające im największe wartości własne. Otrzymana konfiguracja <span class="math inline">\(X_p\)</span> odwzorowuje relacje odległości w sposób minimalizujący błąd w sensie średniokwadratowym.</p>
</section><section id="kryterium-dopasowania" class="level4"><h4 class="anchored" data-anchor-id="kryterium-dopasowania">Kryterium dopasowania</h4>
<p>W wersji metrycznej minimalizuje się błąd rekonstrukcji odległości <span class="math display">\[
\min_{X} \sum_{i&lt;j} \bigl( d_{ij}(X) - \delta_{ij} \bigr)^2.
\]</span> Rozwiązanie klasycznej wersji powyższego problemu daje wprost powyższa dekompozycja macierzy <span class="math inline">\(B\)</span>, dlatego często określa się ją jako <em>Classical Scaling</em> lub <em>Principal Coordinates Analysis</em> (PCoA). Metoda ta jest w pełni analityczna i odpowiada PCA zastosowanej do macierzy odległości.</p>
</section></section><section id="wersja-niemetryczna-non-metric-mds" class="level3"><h3 class="anchored" data-anchor-id="wersja-niemetryczna-non-metric-mds">Wersja niemetryczna (Non-metric MDS)</h3>
<section id="założenia-1" class="level4"><h4 class="anchored" data-anchor-id="założenia-1">Założenia</h4>
<p>W wersji niemetrycznej nie wymaga się, aby wartości <span class="math inline">\(\delta_{ij}\)</span> były dokładnymi odległościami — mogą być dowolnymi miarami niepodobieństwa, niekoniecznie metrycznymi (np. o charakterze porządkowym). Celem jest znalezienie konfiguracji <span class="math inline">\(X\)</span>, dla której rangi odległości <span class="math inline">\(d_{ij}(X)\)</span> są możliwie zgodne z rangami danych <span class="math inline">\(\delta_{ij}\)</span>.</p>
</section><section id="model-i-funkcja-stresu" class="level4"><h4 class="anchored" data-anchor-id="model-i-funkcja-stresu">Model i funkcja stresu</h4>
<p>Ponieważ nie zakłada się liniowego związku między <span class="math inline">\(\delta_{ij}\)</span> a <span class="math inline">\(d_{ij}(X)\)</span>, wprowadza się monotoniczną funkcję przekształcenia <span class="math inline">\(f(\cdot)\)</span>, która dopasowuje skalę <span class="math display">\[
\hat{\delta}_{ij} = f(d_{ij}(X)),
\]</span> przy czym <span class="math inline">\(f\)</span> zachowuje monotoniczność rangową (jeżeli <span class="math inline">\(\delta_{ij} &gt; \delta_{kl}\)</span>, to <span class="math inline">\(f(\delta_{ij}) &gt; f(\delta_{kl})\)</span>).</p>
<p>Optymalizuje się wtedy miarę stresu Kruskala (STRESS - STandardized REsidual Sum of Squares) <span class="math display">\[
S(X) = \sqrt{\frac{\sum_{i&lt;j} \bigl(f(\delta_{ij}) - d_{ij}(X)\bigr)^2}{\sum_{i&lt;j} d_{ij}(X)^2}}.
\]</span> Minimalizacja stresu odbywa się iteracyjnie — zmienia się położenie punktów <span class="math inline">\(x_i\)</span>, aby zmniejszyć różnicę między rangami obserwowanych i odwzorowanych odległości.</p>
<table class="caption-top table">
<thead><tr class="header">
<th>Wartość STRESS</th>
<th>Ocena dopasowania</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>&lt; 0.05</td>
<td>Doskonałe</td>
</tr>
<tr class="even">
<td>0.05–0.10</td>
<td>Bardzo dobre</td>
</tr>
<tr class="odd">
<td>0.10–0.20</td>
<td>Umiarkowane</td>
</tr>
<tr class="even">
<td>0.20–0.30</td>
<td>Słabe</td>
</tr>
<tr class="odd">
<td>&gt; 0.30</td>
<td>Bardzo słabe (odwzorowanie nieadekwatne)</td>
</tr>
</tbody>
</table></section><section id="interpretacja" class="level4"><h4 class="anchored" data-anchor-id="interpretacja">Interpretacja</h4>
<p>W niemetrycznym MDS nie dąży się do zachowania dokładnych odległości, lecz do zachowania porządku relacji niepodobieństwa, obiekty podobne mają być blisko siebie, a niepodobne — daleko. Dzięki temu metoda jest odporna na nieliniowe zniekształcenia skali w danych wejściowych.</p>
</section></section><section id="porównanie-metod-mds" class="level3"><h3 class="anchored" data-anchor-id="porównanie-metod-mds">Porównanie metod MDS</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 36%">
<col style="width: 40%">
</colgroup>
<thead><tr class="header">
<th>Cecha</th>
<th>Metryczny MDS</th>
<th>Niemetryczny MDS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Typ danych wejściowych</strong></td>
<td>Odległości euklidesowe</td>
<td>Dowolne niepodobieństwa, także porządkowe</td>
</tr>
<tr class="even">
<td><strong>Zależność między danymi a odległościami</strong></td>
<td>Liniowa</td>
<td>Monotoniczna (dowolna funkcja porządkowa)</td>
</tr>
<tr class="odd">
<td><strong>Algorytm</strong></td>
<td>Dekompozycja własna macierzy centrowanej</td>
<td>Iteracyjna optymalizacja stresu</td>
</tr>
<tr class="even">
<td><strong>Kryterium dopasowania</strong></td>
<td>Minimalizacja błędu kwadratowego odległości</td>
<td>Minimalizacja stresu Kruskala</td>
</tr>
<tr class="odd">
<td><strong>Interpretacja</strong></td>
<td>Odtwarza dokładne relacje geometryczne</td>
<td>Odtwarza relacje rangowe (porządek podobieństw)</td>
</tr>
</tbody>
</table>
<p>W praktyce metryczny MDS jest szybszy, prostszy i równoważny klasycznemu podejściu PCA, gdy dane mają charakter metryczny. Niemetryczny MDS natomiast jest bardziej elastyczny — pozwala odwzorować struktury nieliniowe, zachowując tylko relacje porządkowe między obiektami, co czyni go odpowiednim do danych percepcyjnych, preferencyjnych lub ankietowych.</p>
<div id="exm-3" class="theorem example">
<p><span class="theorem-title"><strong>Przykład 5.3 (MDS na danych o odległościach między miastami)</strong></span> &nbsp;</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span>        <span class="co"># isoMDS, UScitiesD</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/adeckmyn/maps">maps</a></span><span class="op">)</span>        <span class="co"># zarysy map</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/">ggrepel</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Dane: odległości drogowe między miastami w USA (w milach)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"UScitiesD"</span><span class="op">)</span>  <span class="co"># obiekt klasy 'dist' z pakietu MASS</span></span>
<span></span>
<span><span class="co"># 1) Metryczny MDS</span></span>
<span><span class="va">mds_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html">cmdscale</a></span><span class="op">(</span><span class="va">UScitiesD</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mds_metric</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                    [,1]       [,2]
Atlanta        -718.7594  142.99427
Chicago        -382.0558 -340.83962
Denver          481.6023  -25.28504
Houston        -161.4663  572.76991
LosAngeles     1203.7380  390.10029
Miami         -1133.5271  581.90731
NewYork       -1072.2357 -519.02423
SanFrancisco   1420.6033  112.58920
Seattle        1341.7225 -579.73928
Washington.DC  -979.6220 -335.47281</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 2) Niemetryczny MDS</span></span>
<span><span class="va">mds_nonmetric</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/isoMDS.html">isoMDS</a></span><span class="op">(</span><span class="va">UScitiesD</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">points</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>initial  value 0.049975 
iter   5 value 0.049265
iter  10 value 0.048377
iter  15 value 0.047490
iter  20 value 0.046603
iter  25 value 0.045715
iter  30 value 0.044828
iter  35 value 0.043941
iter  40 value 0.043053
iter  45 value 0.042166
iter  50 value 0.041278
final  value 0.041278 
stopped after 50 iterations</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mds_nonmetric</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                    [,1]       [,2]
Atlanta        -718.7595  142.99430
Chicago        -382.0558 -340.83969
Denver          481.6024  -25.28505
Houston        -161.1399  572.76696
LosAngeles     1203.7842  389.77723
Miami         -1133.8537  581.91049
NewYork       -1072.2359 -519.02433
SanFrancisco   1420.6036  112.58922
Seattle        1341.6768 -579.41626
Washington.DC  -979.6222 -335.47288</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 3) Ramy danych do wykresu MDS</span></span>
<span><span class="va">mds_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  City <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mds_metric</span><span class="op">)</span>,</span>
<span>  Metric_X <span class="op">=</span> <span class="va">mds_metric</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>  Metric_Y <span class="op">=</span> <span class="va">mds_metric</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>  Nonmetric_X <span class="op">=</span> <span class="va">mds_nonmetric</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>  Nonmetric_Y <span class="op">=</span> <span class="va">mds_nonmetric</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4) Wykresy MDS (po symetrii względem obu osi dla lepszej czytelności)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mds_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="va">Metric_X</span>, y <span class="op">=</span> <span class="op">-</span><span class="va">Metric_Y</span>, label <span class="op">=</span> <span class="va">City</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Metryczny MDS na danych o odległościach między miastami"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Wymiar 1"</span>, y <span class="op">=</span> <span class="st">"Wymiar 2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mds_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="va">Nonmetric_X</span>, y <span class="op">=</span> <span class="op">-</span><span class="va">Nonmetric_Y</span>, label <span class="op">=</span> <span class="va">City</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Niemetryczny MDS na danych o odległościach między miastami"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Wymiar 1"</span>, y <span class="op">=</span> <span class="st">"Wymiar 2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5) Faktyczne położenia miast (long/lat) – nazwy muszą pokrywać się z UScitiesD</span></span>
<span><span class="va">city_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">City</span>,           <span class="op">~</span><span class="va">lon</span>,      <span class="op">~</span><span class="va">lat</span>,</span>
<span>  <span class="st">"Atlanta"</span>,       <span class="op">-</span><span class="fl">84.39</span>,     <span class="fl">33.75</span>,</span>
<span>  <span class="st">"Chicago"</span>,       <span class="op">-</span><span class="fl">87.63</span>,     <span class="fl">41.88</span>,</span>
<span>  <span class="st">"Denver"</span>,       <span class="op">-</span><span class="fl">104.99</span>,     <span class="fl">39.74</span>,</span>
<span>  <span class="st">"Houston"</span>,       <span class="op">-</span><span class="fl">95.37</span>,     <span class="fl">29.76</span>,</span>
<span>  <span class="st">"LosAngeles"</span>,   <span class="op">-</span><span class="fl">118.24</span>,     <span class="fl">34.05</span>,</span>
<span>  <span class="st">"Miami"</span>,         <span class="op">-</span><span class="fl">80.19</span>,     <span class="fl">25.77</span>,</span>
<span>  <span class="st">"NewYork"</span>,       <span class="op">-</span><span class="fl">74.01</span>,     <span class="fl">40.71</span>,</span>
<span>  <span class="st">"SanFrancisco"</span>, <span class="op">-</span><span class="fl">122.42</span>,     <span class="fl">37.77</span>,</span>
<span>  <span class="st">"Seattle"</span>,      <span class="op">-</span><span class="fl">122.33</span>,     <span class="fl">47.61</span>,</span>
<span>  <span class="st">"Washington"</span>,    <span class="op">-</span><span class="fl">77.04</span>,     <span class="fl">38.90</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6) Zarys mapy USA</span></span>
<span><span class="va">usa_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 7) Wykres p3: faktyczna mapa z punktami miast</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usa_map</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"grey95"</span>, color <span class="op">=</span> <span class="st">"grey70"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">city_coords</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggrepel.slowkow.com/reference/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">city_coords</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span>, label <span class="op">=</span> <span class="va">City</span><span class="op">)</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Faktyczne położenie miast na mapie USA"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Długość geograficzna"</span>, y <span class="op">=</span> <span class="st">"Szerokość geograficzna"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 8) Prezentacja obok siebie (patchwork)</span></span>
<span><span class="va">p1</span><span class="op">/</span> <span class="va">p2</span> <span class="op">/</span> <span class="va">p3</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="pca_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="pca_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="864"></a></p>
</figure>
</div>
</div>
</div>
</div>
</section></section><section id="t-sne" class="level2"><h2 class="anchored" data-anchor-id="t-sne">t-SNE</h2>
<p>Metoda <em>t-distributed Stochastic Neighbor Embedding</em> (t-SNE) została opracowana przez Laurensa van der Maatena i Geoffreya Hintona w 2008 roku jako nieliniowa technika redukcji wymiarowości, której celem jest odwzorowanie lokalnej struktury danych wysokowymiarowych w przestrzeni o mniejszej liczbie wymiarów, zwykle dwuwymiarowej lub trójwymiarowej. W przeciwieństwie do metod liniowych, takich jak PCA, t-SNE nie dąży do maksymalizacji wariancji, lecz do zachowania sąsiedztw pomiędzy punktami – obserwacje, które w przestrzeni oryginalnej są blisko siebie, powinny również pozostawać blisko w przestrzeni odwzorowania.</p>
<p>Niech dane wejściowe tworzą macierz <span class="math inline">\(X = [x_1, x_2, \dots, x_n]^\top\)</span>, gdzie każdy wektor <span class="math inline">\(x_i \in \mathbb{R}^p\)</span> reprezentuje jedną obserwację w przestrzeni o wymiarze <span class="math inline">\(p\)</span>. Pierwszym krokiem jest przekształcenie danych wysokowymiarowych w macierz podobieństw, która opisuje, jak bardzo punkty są „bliskie” względem siebie. Dla każdego punktu <span class="math inline">\(x_i\)</span> definiuje się rozkład warunkowy <span class="math display">\[
p_{j|i} = \frac{\exp\!\left(-\frac{|x_i - x_j|^2}{2\sigma_i^2}\right)}{\sum_{k \neq i} \exp\!\left(-\frac{|x_i - x_k|^2}{2\sigma_i^2}\right)}, \quad p_{i|i} = 0,
\]</span> gdzie parametr <span class="math inline">\(\sigma_i\)</span> (odpowiednik <em>bandwidth</em>) dobiera się tak, aby entropia rozkładu <span class="math inline">\(P_i = (p_{j|i})_j = (p_{1|i}, p_{2|i}, \dots, p_{n|i}).\)</span> odpowiadała zadanej <em>perplexity</em>, czyli efektywnej liczbie sąsiadów. <em>Perplexity</em> jest hiperparametrem kontrolującym zakres lokalności analizowanych relacji.</p>
<p>Następnie konstruuje się symetryczną macierz podobieństw <span class="math display">\[
p_{ij} = \frac{p_{i|j} + p_{j|i}}{2n},
\]</span> która reprezentuje prawdopodobieństwo, że punkty <span class="math inline">\(x_i\)</span> i <span class="math inline">\(x_j\)</span> są bliskimi sąsiadami w przestrzeni oryginalnej.</p>
<p>Kolejnym krokiem jest utworzenie analogicznego rozkładu w przestrzeni odwzorowania <span class="math inline">\(Y = [y_1, y_2, \dots, y_n]^\top\)</span>, gdzie <span class="math inline">\(y_i \in \mathbb{R}^q\)</span> i zwykle <span class="math inline">\(q = 2\)</span> lub 3. Dla tych punktów definiuje się rozkład podobieństw oparty na rozkładzie t-Studenta z jednym stopniem swobody <span class="math display">\[
q_{ij} = \frac{(1 + |y_i - y_j|^2)^{-1}}{\sum_{k \neq l} (1 + |y_k - y_l|^2)^{-1}}, \quad q_{ii} = 0.
\]</span> Rozkład t-Studenta ma grube ogony, co umożliwia bardziej realistyczne odwzorowanie relacji między punktami odległymi od siebie i redukuje problem <em>crowding</em>, czyli nadmiernego ściskania punktów w centrum przestrzeni odwzorowania.</p>
<p>Celem t-SNE jest minimalizacja dywergencji Kullbacka–Leiblera między rozkładami <span class="math inline">\(P\)</span> i <span class="math inline">\(Q\)</span> <span class="math display">\[
C = \operatorname{KL}(P \| Q) = \sum_{i \neq j} p_{ij} \log \frac{p_{ij}}{q_{ij}}.
\]</span> Optymalizacja tej funkcji, zwykle za pomocą spadku gradientowego, prowadzi do znalezienia takich współrzędnych <span class="math inline">\(Y\)</span>, które zachowują lokalne relacje między punktami w jak największym stopniu. Gradient funkcji celu względem współrzędnych <span class="math inline">\(y_i\)</span> ma postać <span class="math display">\[
\frac{\partial C}{\partial y_i} = 4 \sum_j (p_{ij} - q_{ij}) (y_i - y_j) (1 + \|y_i - y_j\|^2)^{-1},
\]</span> a współczynnik 4 pełni rolę skalującą. W praktyce stosuje się dodatkowe techniki stabilizujące proces uczenia, takie jak <em>momentum</em>, etap <em>early exaggeration</em> zwiększający kontrast lokalnych podobieństw, oraz wcześniejszą redukcję wymiarowości metodą PCA w celu ograniczenia szumu.</p>
<p>Metoda t-SNE nie zakłada liniowości ani rozkładu normalnego danych, lecz wymaga, aby dane były znormalizowane w przypadku różnych jednostek pomiarowych, ponieważ odległości euklidesowe są wrażliwe na skalę. Wskazane jest wcześniejsze zastosowanie PCA w celu usunięcia szumu i zmniejszenia złożoności obliczeniowej. Dane nie powinny zawierać dużej liczby wartości odstających ani duplikatów, które mogłyby zaburzyć lokalne struktury. Kluczowy hiperparametr <em>perplexity</em> powinien być dostosowany do liczby obserwacji — zbyt mała wartość prowadzi do przeuczenia lokalnego, a zbyt duża powoduje zatarcie drobnych struktur.</p>
<p>Wyniki t-SNE przedstawione w przestrzeni dwuwymiarowej lub trójwymiarowej nie mają interpretacji metrycznej. Oznacza to, że odległości między klastrami nie są bezpośrednio interpretowalne ilościowo. Interpretacja opiera się głównie na analizie sąsiedztwa: punkty znajdujące się blisko siebie w przestrzeni t-SNE odpowiadają obserwacjom podobnym w oryginalnych cechach, natomiast wyraźne skupiska punktów mogą wskazywać na istnienie klas lub podgrup. Oś pierwsza i druga nie mają znaczenia merytorycznego – są jedynie współrzędnymi w przestrzeni odwzorowania, które zachowuje lokalną strukturę, a nie globalną geometrię danych.</p>
<div id="exm-4" class="theorem example">
<p><span class="theorem-title"><strong>Przykład 5.4 (t-SNE na danych o kwiatach irysa)</strong></span> &nbsp;</p>
<div class="cell">
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jkrijthe/Rtsne">Rtsne</a></span><span class="op">)</span>      <span class="co"># t-SNE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>  <span class="co"># dla powtarzalności wyników</span></span>
<span></span>
<span><span class="co"># Przygotowanie danych (usunięcie kolumny z gatunkiem)</span></span>
<span><span class="va">iris_data</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Standaryzacja danych</span></span>
<span><span class="va">iris_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">iris_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Uruchomienie t-SNE</span></span>
<span><span class="va">tsne_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html">Rtsne</a></span><span class="op">(</span><span class="va">iris_data</span>, dims <span class="op">=</span> <span class="fl">2</span>, perplexity <span class="op">=</span> <span class="fl">30</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, max_iter <span class="op">=</span> <span class="fl">500</span>, check_duplicates <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Performing PCA
Read the 150 x 4 data matrix successfully!
Using no_dims = 2, perplexity = 30.000000, and theta = 0.500000
Computing input similarities...
Building tree...
Done in 0.00 seconds (sparsity = 0.711156)!
Learning embedding...
Iteration 50: error is 47.841869 (50 iterations in 0.01 seconds)
Iteration 100: error is 46.368218 (50 iterations in 0.01 seconds)
Iteration 150: error is 46.046882 (50 iterations in 0.01 seconds)
Iteration 200: error is 45.081783 (50 iterations in 0.01 seconds)
Iteration 250: error is 46.811730 (50 iterations in 0.01 seconds)
Iteration 300: error is 0.286001 (50 iterations in 0.01 seconds)
Iteration 350: error is 0.164006 (50 iterations in 0.01 seconds)
Iteration 400: error is 0.154655 (50 iterations in 0.01 seconds)
Iteration 450: error is 0.153415 (50 iterations in 0.01 seconds)
Iteration 500: error is 0.151347 (50 iterations in 0.01 seconds)
Fitting performed in 0.07 seconds.</code></pre>
</div>
<details open="" class="code-fold"><summary>Kod</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ramy danych do wykresu</span></span>
<span><span class="va">tsne_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Dim1 <span class="op">=</span> <span class="va">tsne_result</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>  Dim2 <span class="op">=</span> <span class="va">tsne_result</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>  Species <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wykres t-SNE</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tsne_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Dim1</span>, y <span class="op">=</span> <span class="va">Dim2</span></span>
<span>, color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"t-SNE na danych o kwiatach irysa"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Wymiar 1"</span>, y <span class="op">=</span> <span class="st">"Wymiar 2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wykres oryginalnych danych (pierwsze dwa wymiary)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span>, color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Oryginalne dane (długość i szerokość działki)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Długość działki (cm)"</span>, y <span class="op">=</span> <span class="st">"Szerokość działki (cm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><a href="pca_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="pca_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="960"></a></p>
</figure>
</div>
</div>
</div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Skopiowano!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Skopiowano!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./sem.html" class="pagination-link" aria-label="Modele strukturalne">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Modele strukturalne</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="Literatura">
        <span class="nav-page-text">Literatura</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Wielowymiarowa analiza danych</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/DariuszMajerek/WAD_new/issues/new" class="toc-action"><i class="bi bi-github"></i>Zgłoś problem</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Dariusz Majerek ©2025</p>
</div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>